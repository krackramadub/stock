-- Logs begin at Wed 2024-09-25 17:18:19 MSK, end at Tue 2024-10-08 17:46:17 MSK. --
Sep 26 10:57:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: DATA collected for source None
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Failed to connect to 192.168.32.100:9000
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 399, in connect
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._init_connection(host, port)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.socket = self._create_socket(host, port)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise err
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     sock.connect(sa)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: socket.timeout: timed out
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 522, in send_statement
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.client.execute(stmt, with_column_types=True)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     with self.disconnect_on_error(query, settings):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return next(self.gen)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.establish_connection(settings)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connection.force_connect()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connect()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise err
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 384, in make_transformation
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = TransformationTask(conditions)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 144, in __init__
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 984, in _get_db_data
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.send_statement(prepared_sql)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 525, in send_statement
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (SocketTimeoutError('(192.168.32.100:9000)'),)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 522, in send_statement
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.client.execute(stmt, with_column_types=True)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     with self.disconnect_on_error(query, settings):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return next(self.gen)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.establish_connection(settings)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connection.force_connect()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connect()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise err
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 144, in __init__
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 984, in _get_db_data
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.send_statement(prepared_sql)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 526, in send_statement
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: packages.exceptions.BadRequest: Code: 209. (192.168.32.100:9000)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 384, in make_transformation
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = TransformationTask(conditions)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 148, in __init__
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (BadRequest('Code: 209. (192.168.32.100:9000)'),)
Sep 26 10:57:14 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (BadRequest('Code: 209. (192.168.32.100:9000)'), 'Ошибка получения данных из базы')
Sep 26 15:24:01 sppr-app1.vniigaz.gazprom.ru sh[3147426]: DATA collected for source None
Sep 26 15:24:02 sppr-app1.vniigaz.gazprom.ru sh[3147426]: trying to delete table from SE transform_s1_result
Sep 26 15:24:02 sppr-app1.vniigaz.gazprom.ru sh[3147426]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 26 15:24:02 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Obtained table_uuid None for delete
Sep 26 15:24:02 sppr-app1.vniigaz.gazprom.ru sh[3147426]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: SE POST table_and_fields/ responses:
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: {'detail': 'Таблица с таким именем уже существует'}
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 252, in create_table_and_fields
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise BadRequest(get_parsed_error(result))
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 385, in make_transformation
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task.create_table_and_fields()
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 266, in create_table_and_fields
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 26 15:24:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 26 17:08:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: DATA collected for source None
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 242, in _get_db_data
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise CacheMiss()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: apps.bi.exceptions.CacheMiss
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.dialect.do_execute(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     cursor.execute(statement, parameters)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:                                              ^
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: The above exception was the direct cause of the following exception:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 100, in send_statement
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = connection.execute(text(stmt))
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return meth(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return connection._execute_clauseelement(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     ret = self._execute_context(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._exec_single_context(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._handle_dbapi_exception(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.dialect.do_execute(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     cursor.execute(statement, parameters)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:                                              ^
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 384, in make_transformation
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = TransformationTask(conditions)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 144, in __init__
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 432, in _get_db_data
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.send_statement(prepared_sql)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 106, in send_statement
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n'),)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 242, in _get_db_data
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise CacheMiss()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: apps.bi.exceptions.CacheMiss
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.dialect.do_execute(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     cursor.execute(statement, parameters)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:                                              ^
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: The above exception was the direct cause of the following exception:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 100, in send_statement
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = connection.execute(text(stmt))
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return meth(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return connection._execute_clauseelement(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     ret = self._execute_context(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._exec_single_context(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._handle_dbapi_exception(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.dialect.do_execute(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     cursor.execute(statement, parameters)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:                                              ^
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 144, in __init__
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 432, in _get_db_data
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.send_statement(prepared_sql)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 107, in send_statement
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:                                              ^
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 384, in make_transformation
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = TransformationTask(conditions)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 148, in __init__
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Sep 26 17:08:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Sep 26 22:13:02 sppr-app1.vniigaz.gazprom.ru sh[3147426]: DATA collected for source None
Sep 26 22:13:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: trying to delete table from SE transform_s1_result
Sep 26 22:13:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 26 22:13:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Obtained table_uuid None for delete
Sep 26 22:13:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: SE POST table_and_fields/ responses:
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: {'detail': 'Таблица с таким именем уже существует'}
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 252, in create_table_and_fields
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise BadRequest(get_parsed_error(result))
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 385, in make_transformation
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task.create_table_and_fields()
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 266, in create_table_and_fields
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 26 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Not Found
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Rescheduling bi.tasks.convert_data_to_xlsx
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 242, in _get_db_data
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise CacheMiss()
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: apps.bi.exceptions.CacheMiss
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 424, in convert_data_to_xlsx
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     data = switch_connector(credentials)._get_db_data(
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 349, in _get_db_data
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tablename = self.obtain_tablename(
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return SEIntegration.obtain_tablename(token, table_id)
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise BadRequest(error)
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: packages.exceptions.BadRequest: Not Found
Sep 26 22:33:15 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1 day, 20:26:45 later at 2024-09-28 16:00:00.189452+00:00
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: DATA collected for source None
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Not Found
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 242, in _get_db_data
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise CacheMiss()
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: apps.bi.exceptions.CacheMiss
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 144, in __init__
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 349, in _get_db_data
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tablename = self.obtain_tablename(
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return SEIntegration.obtain_tablename(token, table_id)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise BadRequest(error)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: packages.exceptions.BadRequest: Not Found
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 384, in make_transformation
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = TransformationTask(conditions)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 148, in __init__
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (BadRequest('Not Found'),)
Sep 27 00:02:03 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (BadRequest('Not Found'), 'Ошибка получения данных из базы')
Sep 27 10:57:05 sppr-app1.vniigaz.gazprom.ru sh[3147426]: DATA collected for source None
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Failed to connect to 192.168.32.100:9000
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 399, in connect
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._init_connection(host, port)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.socket = self._create_socket(host, port)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise err
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     sock.connect(sa)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: socket.timeout: timed out
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 522, in send_statement
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.client.execute(stmt, with_column_types=True)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     with self.disconnect_on_error(query, settings):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return next(self.gen)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.establish_connection(settings)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connection.force_connect()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connect()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise err
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 384, in make_transformation
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = TransformationTask(conditions)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 144, in __init__
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 984, in _get_db_data
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.send_statement(prepared_sql)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 525, in send_statement
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (SocketTimeoutError('(192.168.32.100:9000)'),)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: --- Logging error ---
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 522, in send_statement
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.client.execute(stmt, with_column_types=True)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     with self.disconnect_on_error(query, settings):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return next(self.gen)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.establish_connection(settings)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connection.force_connect()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.connect()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise err
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 144, in __init__
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 984, in _get_db_data
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     result = self.send_statement(prepared_sql)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/databases.py", line 526, in send_statement
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: packages.exceptions.BadRequest: Code: 209. (192.168.32.100:9000)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: During handling of the above exception, another exception occurred:
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = self.format(record)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return fmt.format(record)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     record.message = record.getMessage()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     msg = msg % self.args
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: TypeError: not all arguments converted during string formatting
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Call stack:
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run_task(tasks, task)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     tasks.run_task(task)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     func(*args, **kwargs)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 384, in make_transformation
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = TransformationTask(conditions)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/apps/bi/tasks.py", line 148, in __init__
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Message: 'Exception!'
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Arguments: (BadRequest('Code: 209. (192.168.32.100:9000)'),)
Sep 27 10:57:16 sppr-app1.vniigaz.gazprom.ru sh[3147426]: (BadRequest('Code: 209. (192.168.32.100:9000)'), 'Ошибка получения данных из базы')
Sep 27 11:13:45 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Failed to retrieve tasks. Database unreachable.
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 89, in _execute
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self.cursor.execute(sql, params)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]: psycopg2.errors.UndefinedTable: relation "background_task" does not exist
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]: LINE 1: ...e_id", "background_task"."creator_object_id" FROM "backgroun...
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:                                                              ^
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]: The above exception was the direct cause of the following exception:
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]: Traceback (most recent call last):
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     main()
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     execute_from_command_line(sys.argv)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     utility.execute()
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.execute(*args, **cmd_options)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     output = self.handle(*args, **options)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self.run(*args, **options)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     if not self._tasks.run_next_task(queue):
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._runner.run_next_task(self, queue)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 263, in run_next_task
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     task = self.get_task_to_run(tasks, queue)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 247, in get_task_to_run
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     available_tasks = [task for task in Task.objects.find_available(queue)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/query.py", line 398, in __iter__
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._fetch_all()
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/query.py", line 1881, in _fetch_all
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     self._result_cache = list(self._iterable_class(self))
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/query.py", line 91, in __iter__
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     results = compiler.execute_sql(
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/sql/compiler.py", line 1562, in execute_sql
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     cursor.execute(sql, params)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 102, in execute
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return super().execute(sql, params)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 67, in execute
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self._execute_with_wrappers(
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 80, in _execute_with_wrappers
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return executor(sql, params, many, context)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 89, in _execute
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self.cursor.execute(sql, params)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/utils.py", line 91, in __exit__
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     raise dj_exc_value.with_traceback(traceback) from exc_value
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 89, in _execute
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:     return self.cursor.execute(sql, params)
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]: django.db.utils.ProgrammingError: relation "background_task" does not exist
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]: LINE 1: ...e_id", "background_task"."creator_object_id" FROM "backgroun...
Sep 27 11:13:50 sppr-app1.vniigaz.gazprom.ru sh[3147426]:                                                              ^
Sep 27 11:13:51 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Main process exited, code=exited, status=1/FAILURE
Sep 27 11:13:51 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Failed with result 'exit-code'.
Sep 27 11:13:51 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Consumed 4min 10.239s CPU time.
Sep 30 22:56:00 sppr-app1.vniigaz.gazprom.ru systemd[1]: Started sppr bi-process-tasks service.
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': [{'loc': ['path', 'uuid'], 'msg': 'value is not a valid uuid', 'type': 'type_error.uuid'}]}
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 176, in _get_db_credentials
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     "input_db_credentials": SEIntegration.obtain_credentials(
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Не удалось распознать ошибку
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 137, in __init__
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions.update(self._get_db_credentials())
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 184, in _get_db_credentials
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Не удалось распознать ошибку'),)
Sep 30 22:56:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Не удалось распознать ошибку'), 'Ошибка подключения к базе данных')
Sep 30 22:56:03 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:04 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 30 22:56:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 30 22:56:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:56:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-09-25T12:16:36.718791', 'id': 2553, 'uuid': '85843016-48df-46cf-8281-6841b28e02f0', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:56:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 85843016-48df-46cf-8281-6841b28e02f0 for delete
Sep 30 22:56:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:56:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 85843016-48df-46cf-8281-6841b28e02f0
Sep 30 22:56:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:09 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '766f94c1-194c-44f6-bf93-a4b2759e7dac'}
Sep 30 22:56:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 766f94c1-194c-44f6-bf93-a4b2759e7dac взамен удаленной 85843016-48df-46cf-8281-6841b28e02f0
Sep 30 22:56:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE test_12_screen
Sep 30 22:56:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:56:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:56:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'test_12_screen', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '99cbce64-a60f-4416-8787-1c191ae7b70b'}
Sep 30 22:56:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 99cbce64-a60f-4416-8787-1c191ae7b70b взамен удаленной None
Sep 30 22:56:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 30 22:56:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 30 22:56:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Sep 30 22:56:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:56:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:56:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 30 22:56:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 30 22:56:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:21 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr15
Sep 30 22:56:21 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-09-26T17:46:19.463944', 'id': 2678, 'uuid': 'da45da38-2aac-440c-a0c1-06746d4e3960', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:56:21 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid da45da38-2aac-440c-a0c1-06746d4e3960 for delete
Sep 30 22:56:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:56:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: da45da38-2aac-440c-a0c1-06746d4e3960
Sep 30 22:56:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:22 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '05eb3d92-d89d-421c-8515-59e1dedd9d16'}
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 05eb3d92-d89d-421c-8515-59e1dedd9d16 взамен удаленной da45da38-2aac-440c-a0c1-06746d4e3960
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': [{'loc': ['path', 'uuid'], 'msg': 'value is not a valid uuid', 'type': 'type_error.uuid'}]}
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 176, in _get_db_credentials
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     "input_db_credentials": SEIntegration.obtain_credentials(
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Не удалось распознать ошибку
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 137, in __init__
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions.update(self._get_db_credentials())
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 184, in _get_db_credentials
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Не удалось распознать ошибку'),)
Sep 30 22:56:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Не удалось распознать ошибку'), 'Ошибка подключения к базе данных')
Sep 30 22:56:24 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:25 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:56:25 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2680, 'uuid': '766f94c1-194c-44f6-bf93-a4b2759e7dac', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:56:25 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 766f94c1-194c-44f6-bf93-a4b2759e7dac for delete
Sep 30 22:56:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:56:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 766f94c1-194c-44f6-bf93-a4b2759e7dac
Sep 30 22:56:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:26 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '86f8ae70-1c36-48c1-998c-9485f38a7372'}
Sep 30 22:56:27 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 86f8ae70-1c36-48c1-998c-9485f38a7372 взамен удаленной 766f94c1-194c-44f6-bf93-a4b2759e7dac
Sep 30 22:56:28 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:29 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:56:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2685, 'uuid': '86f8ae70-1c36-48c1-998c-9485f38a7372', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:56:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 86f8ae70-1c36-48c1-998c-9485f38a7372 for delete
Sep 30 22:56:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:56:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 86f8ae70-1c36-48c1-998c-9485f38a7372
Sep 30 22:56:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:31 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:31 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'abe3e85c-d237-4bf1-b101-005329e03cab'}
Sep 30 22:56:31 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица abe3e85c-d237-4bf1-b101-005329e03cab взамен удаленной 86f8ae70-1c36-48c1-998c-9485f38a7372
Sep 30 22:56:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Sep 30 22:56:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:56:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:56:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 30 22:56:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 30 22:56:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:06 later at 2024-09-30 19:56:41.587964+00:00
Sep 30 22:56:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr2
Sep 30 22:56:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-09-25T12:16:36.709853', 'id': 2552, 'uuid': 'ceab90b6-f0a7-4a35-8b40-83c66068541a', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:56:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid ceab90b6-f0a7-4a35-8b40-83c66068541a for delete
Sep 30 22:56:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:56:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: ceab90b6-f0a7-4a35-8b40-83c66068541a
Sep 30 22:56:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_value', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_gk', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_gk_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '972b700e-7a82-4f77-bc5a-7a052673224a'}
Sep 30 22:56:39 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 972b700e-7a82-4f77-bc5a-7a052673224a взамен удаленной ceab90b6-f0a7-4a35-8b40-83c66068541a
Sep 30 22:56:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:56:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2686, 'uuid': 'abe3e85c-d237-4bf1-b101-005329e03cab', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:56:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid abe3e85c-d237-4bf1-b101-005329e03cab for delete
Sep 30 22:56:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:56:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: abe3e85c-d237-4bf1-b101-005329e03cab
Sep 30 22:56:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '42644db6-8ecc-4e56-ad84-fd2fba12844a'}
Sep 30 22:56:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 42644db6-8ecc-4e56-ad84-fd2fba12844a взамен удаленной abe3e85c-d237-4bf1-b101-005329e03cab
Sep 30 22:56:44 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:56:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2689, 'uuid': '42644db6-8ecc-4e56-ad84-fd2fba12844a', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:56:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 42644db6-8ecc-4e56-ad84-fd2fba12844a for delete
Sep 30 22:56:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:56:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 42644db6-8ecc-4e56-ad84-fd2fba12844a
Sep 30 22:56:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:56:46 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:56:46 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '9ed6dec8-cb4f-4433-8b54-46c8d9256ce9'}
Sep 30 22:56:46 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 9ed6dec8-cb4f-4433-8b54-46c8d9256ce9 взамен удаленной 42644db6-8ecc-4e56-ad84-fd2fba12844a
Sep 30 22:56:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Failed to connect to 192.168.32.100:9000
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 399, in connect
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._init_connection(host, port)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.socket = self._create_socket(host, port)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     sock.connect(sa)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: socket.timeout: timed out
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 527, in send_statement
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (SocketTimeoutError('(192.168.32.100:9000)'),)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 528, in send_statement
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Code: 209. (192.168.32.100:9000)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Code: 209. (192.168.32.100:9000)'),)
Sep 30 22:56:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Code: 209. (192.168.32.100:9000)'), 'Ошибка получения данных из базы')
Sep 30 22:57:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n'),)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': [{'loc': ['path', 'uuid'], 'msg': 'value is not a valid uuid', 'type': 'type_error.uuid'}]}
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 176, in _get_db_credentials
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     "input_db_credentials": SEIntegration.obtain_credentials(
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Не удалось распознать ошибку
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 137, in __init__
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions.update(self._get_db_credentials())
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 184, in _get_db_credentials
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Не удалось распознать ошибку'),)
Sep 30 22:57:01 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Не удалось распознать ошибку'), 'Ошибка подключения к базе данных')
Sep 30 22:57:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:03 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:57:03 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2690, 'uuid': '9ed6dec8-cb4f-4433-8b54-46c8d9256ce9', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:03 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 9ed6dec8-cb4f-4433-8b54-46c8d9256ce9 for delete
Sep 30 22:57:04 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:04 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 9ed6dec8-cb4f-4433-8b54-46c8d9256ce9
Sep 30 22:57:04 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:04 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:04 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '3d1a2d47-e1fd-4aca-a390-3ec6d54f310c'}
Sep 30 22:57:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 3d1a2d47-e1fd-4aca-a390-3ec6d54f310c взамен удаленной 9ed6dec8-cb4f-4433-8b54-46c8d9256ce9
Sep 30 22:57:06 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:57:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2691, 'uuid': '3d1a2d47-e1fd-4aca-a390-3ec6d54f310c', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 3d1a2d47-e1fd-4aca-a390-3ec6d54f310c for delete
Sep 30 22:57:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 3d1a2d47-e1fd-4aca-a390-3ec6d54f310c
Sep 30 22:57:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:08 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'f1ae6a50-1e21-499b-bf9c-26e358130a05'}
Sep 30 22:57:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица f1ae6a50-1e21-499b-bf9c-26e358130a05 взамен удаленной 3d1a2d47-e1fd-4aca-a390-3ec6d54f310c
Sep 30 22:57:10 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr1_dev_plan
Sep 30 22:57:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr1_dev_plan', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-09-26T17:46:19.460833', 'id': 2675, 'uuid': 'bc356f46-b23e-486f-b8dc-d4e6bcd6a850', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid bc356f46-b23e-486f-b8dc-d4e6bcd6a850 for delete
Sep 30 22:57:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: bc356f46-b23e-486f-b8dc-d4e6bcd6a850
Sep 30 22:57:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr1_dev_plan', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'period_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:12 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '5ab98185-13b7-4531-985f-3611816d2e82'}
Sep 30 22:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 5ab98185-13b7-4531-985f-3611816d2e82 взамен удаленной bc356f46-b23e-486f-b8dc-d4e6bcd6a850
Sep 30 22:57:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 30 22:57:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 30 22:57:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:57:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2692, 'uuid': 'f1ae6a50-1e21-499b-bf9c-26e358130a05', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid f1ae6a50-1e21-499b-bf9c-26e358130a05 for delete
Sep 30 22:57:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: f1ae6a50-1e21-499b-bf9c-26e358130a05
Sep 30 22:57:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:19 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'ddabaa84-0e96-4f21-8ad8-923bb4606806'}
Sep 30 22:57:19 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица ddabaa84-0e96-4f21-8ad8-923bb4606806 взамен удаленной f1ae6a50-1e21-499b-bf9c-26e358130a05
Sep 30 22:57:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:21 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE test12
Sep 30 22:57:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:57:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:57:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'test12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:22 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '6c2ce755-16de-49ea-8a33-55e6646036b8'}
Sep 30 22:57:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 6c2ce755-16de-49ea-8a33-55e6646036b8 взамен удаленной None
Sep 30 22:57:24 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:25 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE test12
Sep 30 22:57:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'test12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2696, 'uuid': '6c2ce755-16de-49ea-8a33-55e6646036b8', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 6c2ce755-16de-49ea-8a33-55e6646036b8 for delete
Sep 30 22:57:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 6c2ce755-16de-49ea-8a33-55e6646036b8
Sep 30 22:57:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'test12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:26 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '85d81085-fc3b-4bf8-b5c8-67afb96ccdd0'}
Sep 30 22:57:27 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 85d81085-fc3b-4bf8-b5c8-67afb96ccdd0 взамен удаленной 6c2ce755-16de-49ea-8a33-55e6646036b8
Sep 30 22:57:28 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:29 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:57:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2695, 'uuid': 'ddabaa84-0e96-4f21-8ad8-923bb4606806', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid ddabaa84-0e96-4f21-8ad8-923bb4606806 for delete
Sep 30 22:57:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: ddabaa84-0e96-4f21-8ad8-923bb4606806
Sep 30 22:57:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:31 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:31 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '46aa7ffc-e0f4-4efb-b5c2-a0b55eafb6f2'}
Sep 30 22:57:31 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 46aa7ffc-e0f4-4efb-b5c2-a0b55eafb6f2 взамен удаленной ddabaa84-0e96-4f21-8ad8-923bb4606806
Sep 30 22:57:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:57:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2698, 'uuid': '46aa7ffc-e0f4-4efb-b5c2-a0b55eafb6f2', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 46aa7ffc-e0f4-4efb-b5c2-a0b55eafb6f2 for delete
Sep 30 22:57:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 46aa7ffc-e0f4-4efb-b5c2-a0b55eafb6f2
Sep 30 22:57:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:35 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '635606db-bce0-408f-ae23-6f77dcfc1093'}
Sep 30 22:57:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 635606db-bce0-408f-ae23-6f77dcfc1093 взамен удаленной 46aa7ffc-e0f4-4efb-b5c2-a0b55eafb6f2
Sep 30 22:57:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:57:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2699, 'uuid': '635606db-bce0-408f-ae23-6f77dcfc1093', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 635606db-bce0-408f-ae23-6f77dcfc1093 for delete
Sep 30 22:57:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:57:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 635606db-bce0-408f-ae23-6f77dcfc1093
Sep 30 22:57:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:57:39 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:39 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '27b60f52-cf7f-4bc0-bc36-14b35c548449'}
Sep 30 22:57:39 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 27b60f52-cf7f-4bc0-bc36-14b35c548449 взамен удаленной 635606db-bce0-408f-ae23-6f77dcfc1093
Sep 30 22:57:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Sep 30 22:57:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:57:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:57:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 30 22:57:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 30 22:57:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Failed to connect to 192.168.32.100:9000
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 399, in connect
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._init_connection(host, port)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.socket = self._create_socket(host, port)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     sock.connect(sa)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: socket.timeout: timed out
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 527, in send_statement
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (SocketTimeoutError('(192.168.32.100:9000)'),)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 528, in send_statement
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Code: 209. (192.168.32.100:9000)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Code: 209. (192.168.32.100:9000)'),)
Sep 30 22:57:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Code: 209. (192.168.32.100:9000)'), 'Ошибка получения данных из базы')
Sep 30 22:57:55 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:55 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Sep 30 22:57:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': [{'loc': ['path', 'uuid'], 'msg': 'value is not a valid uuid', 'type': 'type_error.uuid'}]}
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 176, in _get_db_credentials
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     "input_db_credentials": SEIntegration.obtain_credentials(
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Не удалось распознать ошибку
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 137, in __init__
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions.update(self._get_db_credentials())
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 184, in _get_db_credentials
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Не удалось распознать ошибку'),)
Sep 30 22:57:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Не удалось распознать ошибку'), 'Ошибка подключения к базе данных')
Sep 30 22:57:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:57:59 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Sep 30 22:57:59 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'need_to_create': True, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'id': 2700, 'uuid': '27b60f52-cf7f-4bc0-bc36-14b35c548449', 'status': 'created', 'schema_name': 'public'}]}
Sep 30 22:57:59 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 27b60f52-cf7f-4bc0-bc36-14b35c548449 for delete
Sep 30 22:58:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Sep 30 22:58:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 27b60f52-cf7f-4bc0-bc36-14b35c548449
Sep 30 22:58:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Sep 30 22:58:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Sep 30 22:58:00 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'b0f2df67-7920-4d57-8d32-66f08d1778ca'}
Sep 30 22:58:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица b0f2df67-7920-4d57-8d32-66f08d1778ca взамен удаленной 27b60f52-cf7f-4bc0-bc36-14b35c548449
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Not Found
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tablename = self.obtain_tablename(
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.obtain_tablename(token, table_id)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(error)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Not Found
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Not Found'),)
Sep 30 22:58:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Not Found'), 'Ошибка получения данных из базы')
Sep 30 22:58:03 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Failed to connect to 192.168.32.100:9000
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 399, in connect
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._init_connection(host, port)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.socket = self._create_socket(host, port)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     sock.connect(sa)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: socket.timeout: timed out
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 527, in send_statement
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (SocketTimeoutError('(192.168.32.100:9000)'),)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 528, in send_statement
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Code: 209. (192.168.32.100:9000)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Code: 209. (192.168.32.100:9000)'),)
Sep 30 22:58:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Code: 209. (192.168.32.100:9000)'), 'Ошибка получения данных из базы')
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Sep 30 23:08:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 20:08:19.998045+00:00
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Sep 30 23:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 20:18:20.090766+00:00
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Sep 30 23:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 20:28:20.157473+00:00
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Sep 30 23:38:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 20:38:20.284115+00:00
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Sep 30 23:48:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 20:48:20.451832+00:00
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Sep 30 23:58:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 20:58:20.574858+00:00
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 21:08:20.667797+00:00
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 00:18:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 21:18:20.774490+00:00
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 00:28:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 21:28:20.860823+00:00
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 00:38:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 21:38:21.065037+00:00
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 00:48:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 21:48:21.217578+00:00
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 00:58:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 21:58:21.425890+00:00
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 01:08:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 22:08:21.550110+00:00
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 01:18:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 22:18:21.746659+00:00
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 01:28:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 22:28:21.900215+00:00
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 01:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 22:38:22.104746+00:00
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 01:48:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 22:48:22.196202+00:00
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 01:58:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 22:58:22.288211+00:00
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.make_transformation
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 379, in make_transformation
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 02:08:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.make_transformation for 0:00:06 later at 2024-09-30 23:08:22.435897+00:00
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 413, in convert_data_to_xlsx
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 02:18:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 3 days, 20:09:41 later at 2024-10-04 19:27:57.540303+00:00
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 413, in convert_data_to_xlsx
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 02:28:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 3 days, 20:09:41 later at 2024-10-04 19:37:57.748606+00:00
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 21, in get_system_user_token
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     token = response.get("data", {}).get("token", None)
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: AttributeError: 'str' object has no attribute 'get'
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 413, in convert_data_to_xlsx
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     conditions["token"] = get_system_user_token(
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/packages/system_users.py", line 27, in get_system_user_token
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise RequestError(
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.businness_logic_helper.exceptions.RequestError
Oct 01 02:38:16 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 2 days, 6:01:26 later at 2024-10-03 05:39:42.921171+00:00
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:21 later at 2024-09-30 23:41:38.633433+00:00
Oct 01 02:41:18 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr15
Oct 01 02:41:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2684, 'uuid': '05eb3d92-d89d-421c-8515-59e1dedd9d16', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 05eb3d92-d89d-421c-8515-59e1dedd9d16 for delete
Oct 01 02:41:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:41:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 05eb3d92-d89d-421c-8515-59e1dedd9d16
Oct 01 02:41:20 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:21 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:21 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '7432781d-d698-4eff-a288-0761032b2a88'}
Oct 01 02:41:21 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 7432781d-d698-4eff-a288-0761032b2a88 взамен удаленной 05eb3d92-d89d-421c-8515-59e1dedd9d16
Oct 01 02:41:22 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n'),)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Oct 01 02:41:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Oct 01 02:41:24 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:25 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr15
Oct 01 02:41:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2704, 'uuid': '7432781d-d698-4eff-a288-0761032b2a88', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:07.012863', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 7432781d-d698-4eff-a288-0761032b2a88 for delete
Oct 01 02:41:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:41:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 7432781d-d698-4eff-a288-0761032b2a88
Oct 01 02:41:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:26 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:26 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'b1381e4f-2e29-4e6a-a402-101001e157ad'}
Oct 01 02:41:27 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица b1381e4f-2e29-4e6a-a402-101001e157ad взамен удаленной 7432781d-d698-4eff-a288-0761032b2a88
Oct 01 02:41:28 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:29 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:41:29 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2703, 'uuid': 'b0f2df67-7920-4d57-8d32-66f08d1778ca', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-05T15:38:10.933280', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:29 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid b0f2df67-7920-4d57-8d32-66f08d1778ca for delete
Oct 01 02:41:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:41:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: b0f2df67-7920-4d57-8d32-66f08d1778ca
Oct 01 02:41:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:30 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:30 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '15dd3991-9c92-495c-b6ce-8688922f9675'}
Oct 01 02:41:31 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 15dd3991-9c92-495c-b6ce-8688922f9675 взамен удаленной b0f2df67-7920-4d57-8d32-66f08d1778ca
Oct 01 02:41:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:41:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2706, 'uuid': '15dd3991-9c92-495c-b6ce-8688922f9675', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:06.976370', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 15dd3991-9c92-495c-b6ce-8688922f9675 for delete
Oct 01 02:41:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:41:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 15dd3991-9c92-495c-b6ce-8688922f9675
Oct 01 02:41:33 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:34 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '21b57cb2-b2d8-418a-930b-31c05b159ea3'}
Oct 01 02:41:34 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 21b57cb2-b2d8-418a-930b-31c05b159ea3 взамен удаленной 15dd3991-9c92-495c-b6ce-8688922f9675
Oct 01 02:41:35 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE transform_s1_result
Oct 01 02:41:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Oct 01 02:41:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Oct 01 02:41:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'detail': 'Таблица с таким именем уже существует'}
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'detail': 'Таблица с таким именем уже существует'}
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 255, in create_table_and_fields
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     table_uuid = self.output_db_connector.create_table_and_fields(
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 133, in create_table_and_fields
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.create_table_and_fields(token, table_and_fields)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 35, in wrapper
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(get_parsed_error(result))
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Таблица с таким именем уже существует
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 389, in make_transformation
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task.create_table_and_fields()
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 269, in create_table_and_fields
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Таблица с таким именем уже существует'),)
Oct 01 02:41:37 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Таблица с таким именем уже существует'), 'Ошибка создания таблицы')
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Not Found
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tablename = self.obtain_tablename(
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(error)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Not Found
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Not Found'),)
Oct 01 02:41:38 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Not Found'), 'Ошибка получения данных из базы')
Oct 01 02:41:39 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n'),)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Oct 01 02:41:40 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Oct 01 02:41:41 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:42 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE test_screen12
Oct 01 02:41:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': {}}
Oct 01 02:41:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid None for delete
Oct 01 02:41:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'test_screen12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'cbc6a65e-8323-400d-b776-a7f44c4ed4f3'}
Oct 01 02:41:44 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица cbc6a65e-8323-400d-b776-a7f44c4ed4f3 взамен удаленной None
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Not Found
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tablename = self.obtain_tablename(
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(error)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Not Found
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Not Found'),)
Oct 01 02:41:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Not Found'), 'Ошибка получения данных из базы')
Oct 01 02:41:46 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:47 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:41:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2707, 'uuid': '21b57cb2-b2d8-418a-930b-31c05b159ea3', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:07.012863', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 21b57cb2-b2d8-418a-930b-31c05b159ea3 for delete
Oct 01 02:41:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:41:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 21b57cb2-b2d8-418a-930b-31c05b159ea3
Oct 01 02:41:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'eed034cc-d1ab-4325-9522-6332d8038590'}
Oct 01 02:41:49 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица eed034cc-d1ab-4325-9522-6332d8038590 взамен удаленной 21b57cb2-b2d8-418a-930b-31c05b159ea3
Oct 01 02:41:50 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:51 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:41:51 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2710, 'uuid': 'eed034cc-d1ab-4325-9522-6332d8038590', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:07.012863', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:51 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid eed034cc-d1ab-4325-9522-6332d8038590 for delete
Oct 01 02:41:52 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:41:52 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: eed034cc-d1ab-4325-9522-6332d8038590
Oct 01 02:41:52 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:52 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:52 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '6b6b7624-cdec-4628-93ab-36bd00b6d9ae'}
Oct 01 02:41:53 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 6b6b7624-cdec-4628-93ab-36bd00b6d9ae взамен удаленной eed034cc-d1ab-4325-9522-6332d8038590
Oct 01 02:41:54 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:55 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:41:55 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2711, 'uuid': '6b6b7624-cdec-4628-93ab-36bd00b6d9ae', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:06.976370', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:55 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 6b6b7624-cdec-4628-93ab-36bd00b6d9ae for delete
Oct 01 02:41:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:41:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 6b6b7624-cdec-4628-93ab-36bd00b6d9ae
Oct 01 02:41:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:41:56 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:41:56 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'd87893ea-ad67-4f2c-8d86-a79876c6493e'}
Oct 01 02:41:57 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица d87893ea-ad67-4f2c-8d86-a79876c6493e взамен удаленной 6b6b7624-cdec-4628-93ab-36bd00b6d9ae
Oct 01 02:41:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:41:59 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:41:59 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2712, 'uuid': 'd87893ea-ad67-4f2c-8d86-a79876c6493e', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:06.976370', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:41:59 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid d87893ea-ad67-4f2c-8d86-a79876c6493e for delete
Oct 01 02:42:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:42:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: d87893ea-ad67-4f2c-8d86-a79876c6493e
Oct 01 02:42:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:42:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:42:00 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'e94c7afe-8936-4ef7-958a-cc989235fff1'}
Oct 01 02:42:00 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица e94c7afe-8936-4ef7-958a-cc989235fff1 взамен удаленной d87893ea-ad67-4f2c-8d86-a79876c6493e
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n'),)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                              ^
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Oct 01 02:42:02 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Oct 01 02:42:03 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:42:04 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr15
Oct 01 02:42:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2705, 'uuid': 'b1381e4f-2e29-4e6a-a402-101001e157ad', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:07.012863', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:42:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid b1381e4f-2e29-4e6a-a402-101001e157ad for delete
Oct 01 02:42:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:42:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: b1381e4f-2e29-4e6a-a402-101001e157ad
Oct 01 02:42:05 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:42:06 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:42:06 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'baa9706a-5941-4679-9ce5-05142504c0b6'}
Oct 01 02:42:06 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица baa9706a-5941-4679-9ce5-05142504c0b6 взамен удаленной b1381e4f-2e29-4e6a-a402-101001e157ad
Oct 01 02:42:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:42:08 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:42:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2713, 'uuid': 'e94c7afe-8936-4ef7-958a-cc989235fff1', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:07.012863', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:42:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid e94c7afe-8936-4ef7-958a-cc989235fff1 for delete
Oct 01 02:42:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:42:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: e94c7afe-8936-4ef7-958a-cc989235fff1
Oct 01 02:42:09 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:42:10 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:42:10 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': '48c4974c-5c69-4eb2-aa7d-4b9a9dc2f097'}
Oct 01 02:42:10 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица 48c4974c-5c69-4eb2-aa7d-4b9a9dc2f097 взамен удаленной e94c7afe-8936-4ef7-958a-cc989235fff1
Oct 01 02:42:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:42:12 sppr-app1.vniigaz.gazprom.ru sh[634261]: trying to delete table from SE tr_sc2_scr12
Oct 01 02:42:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2715, 'uuid': '48c4974c-5c69-4eb2-aa7d-4b9a9dc2f097', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-09-30T23:03:07.012863', 'status': 'created', 'schema_name': 'public'}]}
Oct 01 02:42:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Obtained table_uuid 48c4974c-5c69-4eb2-aa7d-4b9a9dc2f097 for delete
Oct 01 02:42:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 01 02:42:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Удалена таблица с UUID: 48c4974c-5c69-4eb2-aa7d-4b9a9dc2f097
Oct 01 02:42:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 01 02:42:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: SE POST table_and_fields/ responses:
Oct 01 02:42:14 sppr-app1.vniigaz.gazprom.ru sh[634261]:  {'uuid': 'ae0d56ea-8ce3-4305-970b-3f0aedf5ebb0'}
Oct 01 02:42:14 sppr-app1.vniigaz.gazprom.ru sh[634261]: Создана таблица ae0d56ea-8ce3-4305-970b-3f0aedf5ebb0 взамен удаленной 48c4974c-5c69-4eb2-aa7d-4b9a9dc2f097
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Not Found
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tablename = self.obtain_tablename(
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(error)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Not Found
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Not Found'),)
Oct 01 02:42:15 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Not Found'), 'Ошибка получения данных из базы')
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:42:17 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:01:26 later at 2024-09-30 23:43:43.057535+00:00
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:43:48 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:04:21 later at 2024-09-30 23:48:09.828477+00:00
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:48:11 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:10:30 later at 2024-09-30 23:58:41.375548+00:00
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 02:58:45 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:21:41 later at 2024-10-01 00:20:26.428026+00:00
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 03:20:32 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:40:06 later at 2024-10-01 01:00:38.250908+00:00
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 04:00:43 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:08:21 later at 2024-10-01 02:09:04.653285+00:00
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 05:09:07 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:49:26 later at 2024-10-01 03:58:33.225970+00:00
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 06:58:36 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 2:46:45 later at 2024-10-01 06:45:21.263450+00:00
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise CacheMiss()
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: apps.bi.exceptions.CacheMiss
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = connection.execute(text(stmt))
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return meth(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return connection._execute_clauseelement(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     ret = self._execute_context(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._exec_single_context(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._handle_dbapi_exception(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.dialect.do_execute(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(statement, parameters)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     data = switch_connector(credentials)._get_db_data(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 9: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]:              ^
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: [SQL: select * from (with geo as(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extractable as(
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value/1000) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³'as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as oil,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from hb.start_date) as yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: sum(pb.value) as ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p.short_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from header_material_bal hb
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = h.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p on p.field_uuid = f.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f.name,hb.start_date,p.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: extract(year from pvsf.start_date) as year_fact,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f."name" field_name,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name pool_name,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (CASE
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: end) AS value_fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.gk
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2.name = f.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_gk,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: dd.oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM (
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SELECT
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name as field_type,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: FROM header_fact hf2
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f2."name" = f."name"
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and p.short_name = p2.short_name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and pvsf2.start_date = max(pvsf.start_date)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: GROUP BY
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: rft.name
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) dd
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) fact_oil
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from pden_vol_summary_fact pvsf
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: inner join field f on f.uuid = p2.field_uuid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by f."name" ,extract(year from pvsf.start_date),
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: p2.short_name)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gas as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газ' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'млрд м³' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_gk as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Газовый конденсат' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: union all
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select field_name as field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: pool_name as pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: fact_oil as gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'Нефть' as fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: 'тыс. Т' as units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: )
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: select distinct
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(geo.geo) over(partition by f.field,f.fluid))geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid))ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: round(sum(f.gas) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: from fact f
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: andgeo.field=  ex.field
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and*/ geo.fluid = f.fluid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.pool = f.pool
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and geo.units = f.units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: left join extractable ex on f.pool = ex.pool
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.fluid = ex.fluid
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: and f.units = ex.units
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: group by
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.field,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.fluid,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.pool,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.ex,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: geo.geo,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.gas,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: f.units,
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ex.yyyy
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: ) x ]
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 01 09:45:23 sppr-app1.vniigaz.gazprom.ru sh[634261]: Rescheduling task bi.tasks.convert_data_to_xlsx for 4:04:06 later at 2024-10-01 10:49:29.820812+00:00
Oct 01 10:57:03 sppr-app1.vniigaz.gazprom.ru sh[634261]: DATA collected for source None
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Failed to connect to 192.168.32.100:9000
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 399, in connect
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._init_connection(host, port)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.socket = self._create_socket(host, port)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     sock.connect(sa)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: socket.timeout: timed out
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 527, in send_statement
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (SocketTimeoutError('(192.168.32.100:9000)'),)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: --- Logging error ---
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.client.execute(stmt, with_column_types=True)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     with self.disconnect_on_error(query, settings):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return next(self.gen)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.establish_connection(settings)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connection.force_connect()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.connect()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise err
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     result = self.send_statement(prepared_sql)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/databases.py", line 528, in send_statement
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: packages.exceptions.BadRequest: Code: 209. (192.168.32.100:9000)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: During handling of the above exception, another exception occurred:
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = self.format(record)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return fmt.format(record)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     record.message = record.getMessage()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     msg = msg % self.args
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: TypeError: not all arguments converted during string formatting
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Call stack:
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run_task(tasks, task)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     tasks.run_task(task)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     func(*args, **kwargs)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = TransformationTask(conditions)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Message: 'Exception!'
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: Arguments: (BadRequest('Code: 209. (192.168.32.100:9000)'),)
Oct 01 10:57:13 sppr-app1.vniigaz.gazprom.ru sh[634261]: (BadRequest('Code: 209. (192.168.32.100:9000)'), 'Ошибка получения данных из базы')
Oct 01 12:36:53 sppr-app1.vniigaz.gazprom.ru sh[634261]: Failed to retrieve tasks. Database unreachable.
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 89, in _execute
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self.cursor.execute(sql, params)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: psycopg2.errors.UndefinedTable: relation "background_task" does not exist
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: ...e_id", "background_task"."creator_object_id" FROM "backgroun...
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                                              ^
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: The above exception was the direct cause of the following exception:
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: Traceback (most recent call last):
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     main()
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     execute_from_command_line(sys.argv)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     utility.execute()
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.execute(*args, **cmd_options)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     output = self.handle(*args, **options)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self.run(*args, **options)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     if not self._tasks.run_next_task(queue):
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._runner.run_next_task(self, queue)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 263, in run_next_task
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     task = self.get_task_to_run(tasks, queue)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 247, in get_task_to_run
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     available_tasks = [task for task in Task.objects.find_available(queue)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/query.py", line 398, in __iter__
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._fetch_all()
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/query.py", line 1881, in _fetch_all
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     self._result_cache = list(self._iterable_class(self))
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/query.py", line 91, in __iter__
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     results = compiler.execute_sql(
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/models/sql/compiler.py", line 1562, in execute_sql
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     cursor.execute(sql, params)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 102, in execute
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return super().execute(sql, params)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 67, in execute
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self._execute_with_wrappers(
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 80, in _execute_with_wrappers
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return executor(sql, params, many, context)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 89, in _execute
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self.cursor.execute(sql, params)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/utils.py", line 91, in __exit__
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     raise dj_exc_value.with_traceback(traceback) from exc_value
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/db/backends/utils.py", line 89, in _execute
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:     return self.cursor.execute(sql, params)
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: django.db.utils.ProgrammingError: relation "background_task" does not exist
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]: LINE 1: ...e_id", "background_task"."creator_object_id" FROM "backgroun...
Oct 01 12:36:58 sppr-app1.vniigaz.gazprom.ru sh[634261]:                                                              ^
Oct 01 12:36:59 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Main process exited, code=exited, status=1/FAILURE
Oct 01 12:36:59 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Failed with result 'exit-code'.
Oct 01 12:36:59 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Consumed 1min 3.942s CPU time.
Oct 07 17:55:27 sppr-app1.vniigaz.gazprom.ru systemd[1]: Started sppr bi-process-tasks service.
Oct 07 22:13:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 07 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE transform_s1_result
Oct 07 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'transform_s1_result', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3258, 'uuid': 'c8deba5c-17af-4148-a5e5-35a276acaa10', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T16:04:01.761553', 'status': 'created', 'schema_name': 'public'}]}
Oct 07 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid c8deba5c-17af-4148-a5e5-35a276acaa10 for delete
Oct 07 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 07 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: c8deba5c-17af-4148-a5e5-35a276acaa10
Oct 07 22:13:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Oct 07 22:13:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 07 22:13:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '104d9d43-e935-42d9-87de-3f195d736faa'}
Oct 07 22:13:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 104d9d43-e935-42d9-87de-3f195d736faa взамен удаленной c8deba5c-17af-4148-a5e5-35a276acaa10
Oct 08 00:00:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:00:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr5_fast
Oct 08 00:00:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr5_fast', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3261, 'uuid': '3d22de4f-ac87-4d58-8517-b904e978c87e', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:00:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 3d22de4f-ac87-4d58-8517-b904e978c87e for delete
Oct 08 00:00:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:00:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 3d22de4f-ac87-4d58-8517-b904e978c87e
Oct 08 00:00:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr5_fast', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'measure', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'well_name', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'p_mpa', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:00:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:00:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '6f4c0112-4656-46e4-8625-279c6b58036d'}
Oct 08 00:00:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 6f4c0112-4656-46e4-8625-279c6b58036d взамен удаленной 3d22de4f-ac87-4d58-8517-b904e978c87e
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "sc1_scr1_ksts" does not exist
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (select year_plan, 'key' as test,'key2' as test from sc1_scr1_ksts) x ]
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     task = TransformationTask(conditions)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist\nLINE 1: ...lect year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_k...\n                                                             ^\n'),)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "sc1_scr1_ksts" does not exist
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (select year_plan, 'key' as test,'key2' as test from sc1_scr1_ksts) x ]
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (select year_plan, 'key' as test,'key2' as test from sc1_scr1_ksts) x ]
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     task = TransformationTask(conditions)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist\nLINE 1: ...lect year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_k...\n                                                             ^\n\n[SQL: select * from (select year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Oct 08 00:00:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist\nLINE 1: ...lect year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_k...\n                                                             ^\n\n[SQL: select * from (select year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Oct 08 00:00:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:00:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr11
Oct 08 00:00:31 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr11', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3262, 'uuid': '0a45b3e0-6983-41a1-8e44-0124e446f4bf', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:00:31 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 0a45b3e0-6983-41a1-8e44-0124e446f4bf for delete
Oct 08 00:00:31 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:00:31 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 0a45b3e0-6983-41a1-8e44-0124e446f4bf
Oct 08 00:00:31 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr11', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:00:31 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:00:31 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '00c6f474-8d60-406e-a689-aa70a0c3b7a2'}
Oct 08 00:00:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 00c6f474-8d60-406e-a689-aa70a0c3b7a2 взамен удаленной 0a45b3e0-6983-41a1-8e44-0124e446f4bf
Oct 08 00:00:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:00:39 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr14
Oct 08 00:00:39 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3260, 'uuid': '0b208cbf-5349-4595-979e-c9ad1bf6c67b', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:00:39 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 0b208cbf-5349-4595-979e-c9ad1bf6c67b for delete
Oct 08 00:00:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:00:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 0b208cbf-5349-4595-979e-c9ad1bf6c67b
Oct 08 00:00:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_header', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_value', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'short_name_pool', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_field', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_an', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_project', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 00:00:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:00:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'b76dd462-b588-4d7a-b632-7ab034973a6c'}
Oct 08 00:00:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица b76dd462-b588-4d7a-b632-7ab034973a6c взамен удаленной 0b208cbf-5349-4595-979e-c9ad1bf6c67b
Oct 08 00:00:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:00:47 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr11
Oct 08 00:00:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr11', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3259, 'uuid': '7fb095e1-dda1-4c26-8bcb-bcd31920b8a0', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:00:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 7fb095e1-dda1-4c26-8bcb-bcd31920b8a0 for delete
Oct 08 00:00:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:00:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 7fb095e1-dda1-4c26-8bcb-bcd31920b8a0
Oct 08 00:00:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr11', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pool_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:00:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:00:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '538fab76-f9a1-42e9-b80a-1bea42a30446'}
Oct 08 00:00:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 538fab76-f9a1-42e9-b80a-1bea42a30446 взамен удаленной 7fb095e1-dda1-4c26-8bcb-bcd31920b8a0
Oct 08 00:02:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:02:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr2
Oct 08 00:02:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3263, 'uuid': 'ae71b9a6-d560-41c8-87d9-657e4e5a907f', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:02:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid ae71b9a6-d560-41c8-87d9-657e4e5a907f for delete
Oct 08 00:02:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:02:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: ae71b9a6-d560-41c8-87d9-657e4e5a907f
Oct 08 00:02:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'project', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 00:02:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:02:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '20a91ee2-2fa0-4a57-8591-d32bac2665fa'}
Oct 08 00:02:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 20a91ee2-2fa0-4a57-8591-d32bac2665fa взамен удаленной ae71b9a6-d560-41c8-87d9-657e4e5a907f
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     task = TransformationTask(conditions)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (BadRequest('Not Found'),)
Oct 08 00:02:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (BadRequest('Not Found'), 'Ошибка получения данных из базы')
Oct 08 00:03:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:03:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr8
Oct 08 00:03:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr8', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3264, 'uuid': '1e4f2657-1b44-4537-be60-a76050e1ada2', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:03:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 1e4f2657-1b44-4537-be60-a76050e1ada2 for delete
Oct 08 00:03:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:03:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 1e4f2657-1b44-4537-be60-a76050e1ada2
Oct 08 00:03:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr8', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan_all', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact_all', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:03:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:03:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'e1342591-4e1a-4d95-8b27-05648cc1e287'}
Oct 08 00:03:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица e1342591-4e1a-4d95-8b27-05648cc1e287 взамен удаленной 1e4f2657-1b44-4537-be60-a76050e1ada2
Oct 08 00:04:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:04:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc3_scr2
Oct 08 00:04:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc3_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3265, 'uuid': '7e69f8d5-fc9a-49c6-a553-69dbeb61090b', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:04:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 7e69f8d5-fc9a-49c6-a553-69dbeb61090b for delete
Oct 08 00:04:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:04:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 7e69f8d5-fc9a-49c6-a553-69dbeb61090b
Oct 08 00:04:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc3_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'horizon', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'zapasi', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'nacoplenno', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:04:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:04:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '8f93ff3e-3be2-42a5-903a-d7f3a00b36fd'}
Oct 08 00:04:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 8f93ff3e-3be2-42a5-903a-d7f3a00b36fd взамен удаленной 7e69f8d5-fc9a-49c6-a553-69dbeb61090b
Oct 08 00:05:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:05:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12_fast
Oct 08 00:05:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12_fast', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3266, 'uuid': 'a73686c5-fb5a-464e-8b77-1cb4d8b8d7ea', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:05:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid a73686c5-fb5a-464e-8b77-1cb4d8b8d7ea for delete
Oct 08 00:05:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:05:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: a73686c5-fb5a-464e-8b77-1cb4d8b8d7ea
Oct 08 00:05:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12_fast', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:05:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:05:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'c5126caa-6de3-4fda-9216-775cc2334a68'}
Oct 08 00:05:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица c5126caa-6de3-4fda-9216-775cc2334a68 взамен удаленной a73686c5-fb5a-464e-8b77-1cb4d8b8d7ea
Oct 08 00:08:01 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr9
Oct 08 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr9', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3267, 'uuid': '0e3c2b0f-dcad-4f9e-bafd-3f1c48a0e706', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T16:04:01.761553', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 0e3c2b0f-dcad-4f9e-bafd-3f1c48a0e706 for delete
Oct 08 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 0e3c2b0f-dcad-4f9e-bafd-3f1c48a0e706
Oct 08 00:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr9', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:08:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:08:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '5fe9ce76-d1a3-42c3-a0ef-d318d214e399'}
Oct 08 00:08:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 5fe9ce76-d1a3-42c3-a0ef-d318d214e399 взамен удаленной 0e3c2b0f-dcad-4f9e-bafd-3f1c48a0e706
Oct 08 00:10:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:10:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr14
Oct 08 00:10:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3268, 'uuid': '63e17d3c-c002-4093-8791-00e938f01729', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:10:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 63e17d3c-c002-4093-8791-00e938f01729 for delete
Oct 08 00:10:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:10:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 63e17d3c-c002-4093-8791-00e938f01729
Oct 08 00:10:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_with_ps', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'min_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:10:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:10:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'ad22f035-2378-4b06-a219-d9242838b9d4'}
Oct 08 00:10:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица ad22f035-2378-4b06-a219-d9242838b9d4 взамен удаленной 63e17d3c-c002-4093-8791-00e938f01729
Oct 08 00:10:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:10:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr15
Oct 08 00:10:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr15', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3281, 'uuid': '7303d627-1fac-45c5-a81b-f2b8cace8a69', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:10:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 7303d627-1fac-45c5-a81b-f2b8cace8a69 for delete
Oct 08 00:10:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:10:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 7303d627-1fac-45c5-a81b-f2b8cace8a69
Oct 08 00:10:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr15', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_header', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_value', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'short_name_pool', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_field', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_an', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_project', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:10:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:10:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'f6263587-9d73-4923-a3e5-df71f38be1b7'}
Oct 08 00:10:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица f6263587-9d73-4923-a3e5-df71f38be1b7 взамен удаленной 7303d627-1fac-45c5-a81b-f2b8cace8a69
Oct 08 00:10:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:10:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12114_fast
Oct 08 00:10:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12114_fast', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3269, 'uuid': '0ecee4f6-f205-4bb4-ae91-71a895f49322', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:10:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 0ecee4f6-f205-4bb4-ae91-71a895f49322 for delete
Oct 08 00:10:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:10:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 0ecee4f6-f205-4bb4-ae91-71a895f49322
Oct 08 00:10:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12114_fast', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_plan_fact_past', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan_upper', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_dynamic', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 00:10:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:10:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '985885b6-2fc4-47e7-aaaa-b99d6fbebbe1'}
Oct 08 00:10:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 985885b6-2fc4-47e7-aaaa-b99d6fbebbe1 взамен удаленной 0ecee4f6-f205-4bb4-ae91-71a895f49322
Oct 08 00:12:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:12:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr10
Oct 08 00:12:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr10', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3270, 'uuid': '47d1cfa8-a924-42ba-aa77-0ca850daab59', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:12:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 47d1cfa8-a924-42ba-aa77-0ca850daab59 for delete
Oct 08 00:12:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:12:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 47d1cfa8-a924-42ba-aa77-0ca850daab59
Oct 08 00:12:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr10', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pool', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'geo', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ex', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'rent_kig', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'accumulated_kig', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'licenses', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'cost', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:12:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:12:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '7b505604-89d8-452d-b415-8c5ed6785ed1'}
Oct 08 00:12:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 7b505604-89d8-452d-b415-8c5ed6785ed1 взамен удаленной 47d1cfa8-a924-42ba-aa77-0ca850daab59
Oct 08 00:13:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:13:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr2
Oct 08 00:13:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3271, 'uuid': 'c0d9446a-0ead-44b6-9853-331741509a0d', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T16:04:01.761553', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:13:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid c0d9446a-0ead-44b6-9853-331741509a0d for delete
Oct 08 00:13:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:13:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: c0d9446a-0ead-44b6-9853-331741509a0d
Oct 08 00:13:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'total_color', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'color', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'green', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yellow', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'red', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'absolute', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'procent', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 00:13:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:13:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '5517dbc3-86d9-437d-8028-8449678037e9'}
Oct 08 00:13:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 5517dbc3-86d9-437d-8028-8449678037e9 взамен удаленной c0d9446a-0ead-44b6-9853-331741509a0d
Oct 08 00:13:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:13:20 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr4
Oct 08 00:13:20 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr4', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3286, 'uuid': '794739a0-b1f8-490e-8cbd-09f2a86db526', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T16:04:01.761553', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:13:20 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 794739a0-b1f8-490e-8cbd-09f2a86db526 for delete
Oct 08 00:13:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:13:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 794739a0-b1f8-490e-8cbd-09f2a86db526
Oct 08 00:13:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr4', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pool', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'geo', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ex', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'rent_kig', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'accumulated_kig', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:13:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:13:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '01cf486b-a866-4709-b940-c11e5d7c9c31'}
Oct 08 00:13:22 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 01cf486b-a866-4709-b940-c11e5d7c9c31 взамен удаленной 794739a0-b1f8-490e-8cbd-09f2a86db526
Oct 08 00:15:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:15:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12_4_11
Oct 08 00:15:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12_4_11', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3273, 'uuid': 'b812d9d7-fdc9-4e11-8175-4ae45f3e954a', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:15:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid b812d9d7-fdc9-4e11-8175-4ae45f3e954a for delete
Oct 08 00:15:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:15:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: b812d9d7-fdc9-4e11-8175-4ae45f3e954a
Oct 08 00:15:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12_4_11', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_plan_fact_past', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan_upper', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_dynamic', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 00:15:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:15:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'bb208523-e385-414a-a32d-13412e83a148'}
Oct 08 00:15:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица bb208523-e385-414a-a32d-13412e83a148 взамен удаленной b812d9d7-fdc9-4e11-8175-4ae45f3e954a
Oct 08 00:20:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:20:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr5
Oct 08 00:20:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr5', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3274, 'uuid': '428b2c17-1af5-4081-8ba8-a72dc0af7ba8', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:20:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 428b2c17-1af5-4081-8ba8-a72dc0af7ba8 for delete
Oct 08 00:20:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:20:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 428b2c17-1af5-4081-8ba8-a72dc0af7ba8
Oct 08 00:20:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr5', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'well_name', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'p_mpa', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:20:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:20:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'eb9b65e3-0791-484f-a142-1ffd0deb48fc'}
Oct 08 00:20:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица eb9b65e3-0791-484f-a142-1ffd0deb48fc взамен удаленной 428b2c17-1af5-4081-8ba8-a72dc0af7ba8
Oct 08 00:23:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:23:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr4p
Oct 08 00:23:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr4p', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3275, 'uuid': 'a7b42cc0-43ff-48e0-9fd5-d7ba0fa1b378', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:23:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid a7b42cc0-43ff-48e0-9fd5-d7ba0fa1b378 for delete
Oct 08 00:23:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:23:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: a7b42cc0-43ff-48e0-9fd5-d7ba0fa1b378
Oct 08 00:23:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr4p', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_plan_fact_past', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan_upper', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_dynamic', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg_test', 'is_primary_key': False, 'data_type': 'integer', 'null': True}]}
Oct 08 00:23:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:23:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '1afb4853-c27f-454f-915d-a35dc33a2bf1'}
Oct 08 00:23:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 1afb4853-c27f-454f-915d-a35dc33a2bf1 взамен удаленной a7b42cc0-43ff-48e0-9fd5-d7ba0fa1b378
Oct 08 00:25:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:26:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr13
Oct 08 00:26:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr13', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3276, 'uuid': 'bf22a3d4-84ba-4594-b627-37fec1efdf9d', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T10:30:35.927682', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:26:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid bf22a3d4-84ba-4594-b627-37fec1efdf9d for delete
Oct 08 00:26:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:26:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: bf22a3d4-84ba-4594-b627-37fec1efdf9d
Oct 08 00:26:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr13', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'facility_short_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'p_mpa', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:26:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:26:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '2254af6b-bbb9-46aa-9f02-f4828272cc05'}
Oct 08 00:26:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 2254af6b-bbb9-46aa-9f02-f4828272cc05 взамен удаленной bf22a3d4-84ba-4594-b627-37fec1efdf9d
Oct 08 00:30:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:30:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12
Oct 08 00:30:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3277, 'uuid': '40adac2b-3a64-436b-8331-f537f61d9f2e', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T16:04:01.761553', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:30:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 40adac2b-3a64-436b-8331-f537f61d9f2e for delete
Oct 08 00:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 40adac2b-3a64-436b-8331-f537f61d9f2e
Oct 08 00:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 00:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '8c8b9c6c-7ccf-4423-a583-aaac0e355ce2'}
Oct 08 00:30:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 8c8b9c6c-7ccf-4423-a583-aaac0e355ce2 взамен удаленной 40adac2b-3a64-436b-8331-f537f61d9f2e
Oct 08 00:35:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:35:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr8
Oct 08 00:35:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr8', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3289, 'uuid': 'f048d816-4e13-4e08-879f-282d36c08508', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T16:04:01.761553', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:35:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid f048d816-4e13-4e08-879f-282d36c08508 for delete
Oct 08 00:35:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:35:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: f048d816-4e13-4e08-879f-282d36c08508
Oct 08 00:35:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr8', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'smr_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'smr_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'smr_transfer_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'smr_transfer_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'smr_except_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'smr_except_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_transfer_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_transfer_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_except_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_except_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_smr_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_smr_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_smr_transfer_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_smr_transfer_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_smr_except_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pir_smr_except_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'entering_date_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'entering_date_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'entering_date_transfer_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'entering_date_transfer_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'entering_date_except_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'entering_date_except_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'wrk_not_started_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'wrk_not_started_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'wrk_not_started_transfer_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'wrk_not_started_transfer_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'wrk_not_started_except_year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'wrk_not_started_except_qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'equip_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'equip_count', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'event_description', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'accumulated_prod', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'project_code', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'project_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'deleted', 'is_primary_key': False, 'data_type': 'boolean', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'priority_group', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'investment', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'event_type', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'event_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Oct 08 00:35:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:35:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '263542a8-b212-4c84-9237-3a322040863d'}
Oct 08 00:35:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 263542a8-b212-4c84-9237-3a322040863d взамен удаленной f048d816-4e13-4e08-879f-282d36c08508
Oct 08 00:35:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 00:35:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr2_gdo_for_map
Oct 08 00:35:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr2_gdo_for_map', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3293, 'uuid': '1aa01965-360b-4973-9117-37dccd0a9b09', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-04T16:04:01.761553', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 00:35:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 1aa01965-360b-4973-9117-37dccd0a9b09 for delete
Oct 08 00:35:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 00:35:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 1aa01965-360b-4973-9117-37dccd0a9b09
Oct 08 00:35:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr2_gdo_for_map', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'procent', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'absolute', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'color_description', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'color_count', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 00:35:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 00:35:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '21815b81-d814-412f-9dde-cf466b29218a'}
Oct 08 00:35:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 21815b81-d814-412f-9dde-cf466b29218a взамен удаленной 1aa01965-360b-4973-9117-37dccd0a9b09
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 09:41:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:06 later at 2024-10-08 06:41:24.512314+00:00
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 09:41:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:21 later at 2024-10-08 06:41:51.151355+00:00
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 09:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:01:26 later at 2024-10-08 06:43:22.788993+00:00
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 09:43:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:04:21 later at 2024-10-08 06:47:49.472502+00:00
Oct 08 09:46:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 09:46:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc2_scr1_dev_plan
Oct 08 09:46:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr1_dev_plan', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2985, 'uuid': '2749c5fe-f3a8-4572-8a46-07a9c71595b7', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-09-30T14:47:03.034797', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 09:46:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 2749c5fe-f3a8-4572-8a46-07a9c71595b7 for delete
Oct 08 09:46:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 09:46:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 2749c5fe-f3a8-4572-8a46-07a9c71595b7
Oct 08 09:46:18 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr1_dev_plan', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'period_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 09:46:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 09:46:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'b9fc725a-dd06-4dbf-9c0e-3b56142463c0'}
Oct 08 09:46:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица b9fc725a-dd06-4dbf-9c0e-3b56142463c0 взамен удаленной 2749c5fe-f3a8-4572-8a46-07a9c71595b7
Oct 08 09:46:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 09:46:47 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc2_scr1_dev_plan
Oct 08 09:46:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr1_dev_plan', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3317, 'uuid': 'b9fc725a-dd06-4dbf-9c0e-3b56142463c0', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 09:46:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid b9fc725a-dd06-4dbf-9c0e-3b56142463c0 for delete
Oct 08 09:46:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 09:46:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: b9fc725a-dd06-4dbf-9c0e-3b56142463c0
Oct 08 09:46:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr1_dev_plan', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'period_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 09:46:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 09:46:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '4ba813dc-d20c-4e51-b0cb-4dd10b8824dd'}
Oct 08 09:46:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 4ba813dc-d20c-4e51-b0cb-4dd10b8824dd взамен удаленной b9fc725a-dd06-4dbf-9c0e-3b56142463c0
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 09:47:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:10:30 later at 2024-10-08 06:58:20.928461+00:00
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 09:58:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:21:41 later at 2024-10-08 07:20:06.391608+00:00
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 10:20:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:40:06 later at 2024-10-08 08:00:18.074298+00:00
Oct 08 10:41:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 10:41:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc2_scr12
Oct 08 10:41:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2955, 'uuid': '84bca9b9-30d4-4cb9-bc8d-95bef97be43e', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-09-30T14:47:03.025359', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 10:41:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 84bca9b9-30d4-4cb9-bc8d-95bef97be43e for delete
Oct 08 10:41:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 10:41:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 84bca9b9-30d4-4cb9-bc8d-95bef97be43e
Oct 08 10:41:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 10:41:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 10:41:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '2fc28235-0b97-4d27-8ed7-90cd41f2dc29'}
Oct 08 10:41:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 2fc28235-0b97-4d27-8ed7-90cd41f2dc29 взамен удаленной 84bca9b9-30d4-4cb9-bc8d-95bef97be43e
Oct 08 10:41:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 10:41:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc2_scr15
Oct 08 10:41:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 2956, 'uuid': '9750eade-7a4c-46eb-91db-d61877ab4b1c', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-09-30T14:47:03.025359', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 10:41:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 9750eade-7a4c-46eb-91db-d61877ab4b1c for delete
Oct 08 10:41:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 10:41:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 9750eade-7a4c-46eb-91db-d61877ab4b1c
Oct 08 10:41:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 10:41:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 10:41:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '1aff0600-35e0-4d6f-994e-abb85feb2cb4'}
Oct 08 10:41:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 1aff0600-35e0-4d6f-994e-abb85feb2cb4 взамен удаленной 9750eade-7a4c-46eb-91db-d61877ab4b1c
Oct 08 10:43:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 10:43:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc2_scr15
Oct 08 10:43:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3320, 'uuid': '1aff0600-35e0-4d6f-994e-abb85feb2cb4', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 10:43:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 1aff0600-35e0-4d6f-994e-abb85feb2cb4 for delete
Oct 08 10:43:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 10:43:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 1aff0600-35e0-4d6f-994e-abb85feb2cb4
Oct 08 10:43:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc2_scr15', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy_from', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_until', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'scenario_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'version_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_ml_with_minus_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy1', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy2', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_text_yyyy3', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'value_full_ml', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 10:43:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 10:43:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '4389de24-8bc3-4c17-8c25-70881774bbf1'}
Oct 08 10:43:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 4389de24-8bc3-4c17-8c25-70881774bbf1 взамен удаленной 1aff0600-35e0-4d6f-994e-abb85feb2cb4
Oct 08 10:57:01 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Failed to connect to 192.168.32.100:9000
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 399, in connect
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._init_connection(host, port)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 329, in _init_connection
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.socket = self._create_socket(host, port)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 301, in _create_socket
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise err
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 292, in _create_socket
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     sock.connect(sa)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: socket.timeout: timed out
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.client.execute(stmt, with_column_types=True)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     with self.disconnect_on_error(query, settings):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return next(self.gen)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.establish_connection(settings)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.connection.force_connect()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.connect()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise err
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     task = TransformationTask(conditions)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 527, in send_statement
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (SocketTimeoutError('(192.168.32.100:9000)'),)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 524, in send_statement
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.client.execute(stmt, with_column_types=True)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 370, in execute
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     with self.disconnect_on_error(query, settings):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/contextlib.py", line 113, in __enter__
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return next(self.gen)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 313, in disconnect_on_error
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.establish_connection(settings)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/client.py", line 300, in establish_connection
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.connection.force_connect()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 258, in force_connect
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.connect()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/clickhouse_driver/connection.py", line 420, in connect
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise err
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: clickhouse_driver.errors.SocketTimeoutError: Code: 209. (192.168.32.100:9000)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 986, in _get_db_data
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 528, in send_statement
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Code: 209. (192.168.32.100:9000)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     task = TransformationTask(conditions)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (BadRequest('Code: 209. (192.168.32.100:9000)'),)
Oct 08 10:57:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (BadRequest('Code: 209. (192.168.32.100:9000)'), 'Ошибка получения данных из базы')
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 11:00:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:08:21 later at 2024-10-08 09:08:40.873114+00:00
Oct 08 12:08:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 12:08:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr2_gdo_for_map
Oct 08 12:08:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr2_gdo_for_map', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3316, 'uuid': '21815b81-d814-412f-9dde-cf466b29218a', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 12:08:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 21815b81-d814-412f-9dde-cf466b29218a for delete
Oct 08 12:08:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 12:08:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 21815b81-d814-412f-9dde-cf466b29218a
Oct 08 12:08:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr2_gdo_for_map', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'ba_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'procent', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'absolute', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'color_description', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'color_count', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 12:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 12:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '6d6e798d-9c68-4942-a9c6-3304897cc980'}
Oct 08 12:08:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 6d6e798d-9c68-4942-a9c6-3304897cc980 взамен удаленной 21815b81-d814-412f-9dde-cf466b29218a
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 12:08:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:49:26 later at 2024-10-08 10:58:12.155093+00:00
Oct 08 12:10:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 12:10:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr14
Oct 08 12:10:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3304, 'uuid': 'ad22f035-2378-4b06-a219-d9242838b9d4', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 12:10:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid ad22f035-2378-4b06-a219-d9242838b9d4 for delete
Oct 08 12:10:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 12:10:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: ad22f035-2378-4b06-a219-d9242838b9d4
Oct 08 12:10:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_with_ps', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'min_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 12:10:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 12:10:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'fe8cbee5-f130-484e-82e4-f413a7d5540e'}
Oct 08 12:10:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица fe8cbee5-f130-484e-82e4-f413a7d5540e взамен удаленной ad22f035-2378-4b06-a219-d9242838b9d4
Oct 08 12:10:17 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 12:32:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr9
Oct 08 12:32:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr9', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3303, 'uuid': '5fe9ce76-d1a3-42c3-a0ef-d318d214e399', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 12:32:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 5fe9ce76-d1a3-42c3-a0ef-d318d214e399 for delete
Oct 08 12:32:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 12:32:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 5fe9ce76-d1a3-42c3-a0ef-d318d214e399
Oct 08 12:32:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr9', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'sum_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 12:32:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 12:32:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'fb7dbd6e-dea4-4a4c-9498-1b66a61409eb'}
Oct 08 12:32:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица fb7dbd6e-dea4-4a4c-9498-1b66a61409eb взамен удаленной 5fe9ce76-d1a3-42c3-a0ef-d318d214e399
Oct 08 12:32:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 12:32:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr10
Oct 08 12:32:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr10', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3307, 'uuid': '7b505604-89d8-452d-b415-8c5ed6785ed1', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 12:32:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 7b505604-89d8-452d-b415-8c5ed6785ed1 for delete
Oct 08 12:32:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 12:32:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 7b505604-89d8-452d-b415-8c5ed6785ed1
Oct 08 12:32:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr10', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'pool', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'geo', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'ex', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'rent_kig', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'accumulated_kig', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'licenses', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'cost', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 12:32:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 12:32:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '521972cb-37f9-4322-a799-ea038ed50937'}
Oct 08 12:32:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 521972cb-37f9-4322-a799-ea038ed50937 взамен удаленной 7b505604-89d8-452d-b415-8c5ed6785ed1
Oct 08 12:32:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 12:37:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12
Oct 08 12:37:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3314, 'uuid': '8c8b9c6c-7ccf-4423-a583-aaac0e355ce2', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 12:37:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 8c8b9c6c-7ccf-4423-a583-aaac0e355ce2 for delete
Oct 08 12:37:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 12:37:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 8c8b9c6c-7ccf-4423-a583-aaac0e355ce2
Oct 08 12:37:54 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 12:37:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 12:37:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '8378f3d0-500e-490d-8744-dbfc6a70fcba'}
Oct 08 12:37:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 8378f3d0-500e-490d-8744-dbfc6a70fcba взамен удаленной 8c8b9c6c-7ccf-4423-a583-aaac0e355ce2
Oct 08 12:37:57 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 12:46:23 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr8
Oct 08 12:46:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr8', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3300, 'uuid': 'e1342591-4e1a-4d95-8b27-05648cc1e287', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 12:46:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid e1342591-4e1a-4d95-8b27-05648cc1e287 for delete
Oct 08 12:46:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 12:46:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: e1342591-4e1a-4d95-8b27-05648cc1e287
Oct 08 12:46:24 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr8', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan_all', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact_all', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 12:46:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 12:46:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '7faf6166-3d89-4267-9775-b52e65488aee'}
Oct 08 12:46:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 7faf6166-3d89-4267-9775-b52e65488aee взамен удаленной e1342591-4e1a-4d95-8b27-05648cc1e287
Oct 08 12:46:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 12:48:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr2
Oct 08 12:48:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3299, 'uuid': '20a91ee2-2fa0-4a57-8591-d32bac2665fa', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 12:48:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 20a91ee2-2fa0-4a57-8591-d32bac2665fa for delete
Oct 08 12:48:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 12:48:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 20a91ee2-2fa0-4a57-8591-d32bac2665fa
Oct 08 12:48:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'project', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 12:48:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 12:48:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'd6040657-6100-4c19-91f7-179e9857b90d'}
Oct 08 12:48:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица d6040657-6100-4c19-91f7-179e9857b90d взамен удаленной 20a91ee2-2fa0-4a57-8591-d32bac2665fa
Oct 08 12:48:19 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:00:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr4p
Oct 08 13:00:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr4p', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3312, 'uuid': '1afb4853-c27f-454f-915d-a35dc33a2bf1', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:00:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 1afb4853-c27f-454f-915d-a35dc33a2bf1 for delete
Oct 08 13:00:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:00:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 1afb4853-c27f-454f-915d-a35dc33a2bf1
Oct 08 13:00:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr4p', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_plan_fact_past', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan_upper', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_dynamic', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg_test', 'is_primary_key': False, 'data_type': 'integer', 'null': True}]}
Oct 08 13:00:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:00:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '2c92c3d5-d8a5-4b46-b9e8-4f1da016984e'}
Oct 08 13:00:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 2c92c3d5-d8a5-4b46-b9e8-4f1da016984e взамен удаленной 1afb4853-c27f-454f-915d-a35dc33a2bf1
Oct 08 13:00:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:00:20 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr2
Oct 08 13:00:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3308, 'uuid': '5517dbc3-86d9-437d-8028-8449678037e9', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:00:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 5517dbc3-86d9-437d-8028-8449678037e9 for delete
Oct 08 13:00:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:00:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 5517dbc3-86d9-437d-8028-8449678037e9
Oct 08 13:00:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'total_color', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'color', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'green', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yellow', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'red', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'absolute', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'procent', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 13:00:22 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:00:22 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '27bc15f4-6412-456d-81cd-c80bf673971a'}
Oct 08 13:00:22 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 27bc15f4-6412-456d-81cd-c80bf673971a взамен удаленной 5517dbc3-86d9-437d-8028-8449678037e9
Oct 08 13:00:23 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:00:36 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr11
Oct 08 13:00:36 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr11', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3296, 'uuid': '00c6f474-8d60-406e-a689-aa70a0c3b7a2', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:00:36 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 00c6f474-8d60-406e-a689-aa70a0c3b7a2 for delete
Oct 08 13:00:37 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:00:37 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 00c6f474-8d60-406e-a689-aa70a0c3b7a2
Oct 08 13:00:37 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr11', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:00:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:00:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '1da60ed6-d675-4f5b-8620-57a6586a73fc'}
Oct 08 13:00:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 1da60ed6-d675-4f5b-8620-57a6586a73fc взамен удаленной 00c6f474-8d60-406e-a689-aa70a0c3b7a2
Oct 08 13:00:39 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:00:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc3_scr2
Oct 08 13:00:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc3_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3301, 'uuid': '8f93ff3e-3be2-42a5-903a-d7f3a00b36fd', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:00:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 8f93ff3e-3be2-42a5-903a-d7f3a00b36fd for delete
Oct 08 13:00:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:00:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 8f93ff3e-3be2-42a5-903a-d7f3a00b36fd
Oct 08 13:00:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc3_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'horizon', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'zapasi', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'nacoplenno', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:00:43 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:00:43 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '624f9561-7316-47d9-91f5-f7ecef6c2cd8'}
Oct 08 13:00:43 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 624f9561-7316-47d9-91f5-f7ecef6c2cd8 взамен удаленной 8f93ff3e-3be2-42a5-903a-d7f3a00b36fd
Oct 08 13:00:44 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "sc1_scr1_ksts" does not exist
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (select year_plan, 'key' as test,'key2' as test from sc1_scr1_ksts) x ]
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     task = TransformationTask(conditions)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist\nLINE 1: ...lect year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_k...\n                                                             ^\n'),)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "sc1_scr1_ksts" does not exist
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (select year_plan, 'key' as test,'key2' as test from sc1_scr1_ksts) x ]
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 1: ...lect year_plan, 'key' as test,'key2' as test from sc1_scr1_k...
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:                                                              ^
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (select year_plan, 'key' as test,'key2' as test from sc1_scr1_ksts) x ]
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     task = TransformationTask(conditions)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist\nLINE 1: ...lect year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_k...\n                                                             ^\n\n[SQL: select * from (select year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Oct 08 13:00:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "sc1_scr1_ksts" does not exist\nLINE 1: ...lect year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_k...\n                                                             ^\n\n[SQL: select * from (select year_plan, \'key\' as test,\'key2\' as test from sc1_scr1_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Oct 08 13:00:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:10:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12_4_11
Oct 08 13:10:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12_4_11', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3310, 'uuid': 'bb208523-e385-414a-a32d-13412e83a148', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:10:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid bb208523-e385-414a-a32d-13412e83a148 for delete
Oct 08 13:10:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:10:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: bb208523-e385-414a-a32d-13412e83a148
Oct 08 13:10:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12_4_11', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_plan_fact_past', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan_upper', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_dynamic', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 13:11:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:11:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '6643ae99-a545-4422-8774-63964ee7b084'}
Oct 08 13:11:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 6643ae99-a545-4422-8774-63964ee7b084 взамен удаленной bb208523-e385-414a-a32d-13412e83a148
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:06 later at 2024-10-08 10:11:08.477861+00:00
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:21 later at 2024-10-08 10:11:34.870356+00:00
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:11:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:01:26 later at 2024-10-08 10:13:06.447721+00:00
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:13:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:04:21 later at 2024-10-08 10:17:33.156441+00:00
Oct 08 13:15:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:20:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12
Oct 08 13:20:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3326, 'uuid': '8378f3d0-500e-490d-8744-dbfc6a70fcba', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:20:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 8378f3d0-500e-490d-8744-dbfc6a70fcba for delete
Oct 08 13:20:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:20:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 8378f3d0-500e-490d-8744-dbfc6a70fcba
Oct 08 13:20:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:20:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:20:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'ed0095dd-9c92-49a5-9ac5-963e9bf94817'}
Oct 08 13:20:47 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица ed0095dd-9c92-49a5-9ac5-963e9bf94817 взамен удаленной 8378f3d0-500e-490d-8744-dbfc6a70fcba
Oct 08 13:20:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:21:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr11
Oct 08 13:21:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr11', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3331, 'uuid': '1da60ed6-d675-4f5b-8620-57a6586a73fc', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:21:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 1da60ed6-d675-4f5b-8620-57a6586a73fc for delete
Oct 08 13:21:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:21:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 1da60ed6-d675-4f5b-8620-57a6586a73fc
Oct 08 13:21:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr11', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:21:01 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:21:01 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '232275c6-d4b6-4831-8712-07dceb39b83f'}
Oct 08 13:21:01 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 232275c6-d4b6-4831-8712-07dceb39b83f взамен удаленной 1da60ed6-d675-4f5b-8620-57a6586a73fc
Oct 08 13:21:02 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:29:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12_4_11
Oct 08 13:29:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12_4_11', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3333, 'uuid': '6643ae99-a545-4422-8774-63964ee7b084', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:29:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 6643ae99-a545-4422-8774-63964ee7b084 for delete
Oct 08 13:29:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:29:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 6643ae99-a545-4422-8774-63964ee7b084
Oct 08 13:29:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12_4_11', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_plan_fact_past', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan_upper', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_dynamic', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 13:29:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:29:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'ccb51724-e8c7-45b8-ae31-69f1f3af7566'}
Oct 08 13:29:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица ccb51724-e8c7-45b8-ae31-69f1f3af7566 взамен удаленной 6643ae99-a545-4422-8774-63964ee7b084
Oct 08 13:29:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:30:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr14
Oct 08 13:30:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3323, 'uuid': 'fe8cbee5-f130-484e-82e4-f413a7d5540e', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:30:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid fe8cbee5-f130-484e-82e4-f413a7d5540e for delete
Oct 08 13:30:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:30:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: fe8cbee5-f130-484e-82e4-f413a7d5540e
Oct 08 13:30:11 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_with_ps', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'min_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '97937c58-079b-4fd4-8867-8bf5e91f7ace'}
Oct 08 13:30:12 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 97937c58-079b-4fd4-8867-8bf5e91f7ace взамен удаленной fe8cbee5-f130-484e-82e4-f413a7d5540e
Oct 08 13:30:13 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:38:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr8
Oct 08 13:38:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr8', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3327, 'uuid': '7faf6166-3d89-4267-9775-b52e65488aee', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:38:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 7faf6166-3d89-4267-9775-b52e65488aee for delete
Oct 08 13:38:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:38:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 7faf6166-3d89-4267-9775-b52e65488aee
Oct 08 13:38:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr8', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yyyy_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan_all', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact_all', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:38:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:38:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'd78a5730-854b-4d19-a2c7-abca1bb28e98'}
Oct 08 13:38:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица d78a5730-854b-4d19-a2c7-abca1bb28e98 взамен удаленной 7faf6166-3d89-4267-9775-b52e65488aee
Oct 08 13:38:30 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:38:41 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12_fast
Oct 08 13:38:41 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12_fast', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3302, 'uuid': 'c5126caa-6de3-4fda-9216-775cc2334a68', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:38:41 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid c5126caa-6de3-4fda-9216-775cc2334a68 for delete
Oct 08 13:38:41 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:38:41 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: c5126caa-6de3-4fda-9216-775cc2334a68
Oct 08 13:38:41 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12_fast', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:38:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:38:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '5c9f178f-5a75-4ba0-ab5b-04fce1fb99f9'}
Oct 08 13:38:42 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 5c9f178f-5a75-4ba0-ab5b-04fce1fb99f9 взамен удаленной c5126caa-6de3-4fda-9216-775cc2334a68
Oct 08 13:38:43 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:38:55 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr14
Oct 08 13:38:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3337, 'uuid': '97937c58-079b-4fd4-8867-8bf5e91f7ace', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:38:56 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 97937c58-079b-4fd4-8867-8bf5e91f7ace for delete
Oct 08 13:38:57 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:38:57 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 97937c58-079b-4fd4-8867-8bf5e91f7ace
Oct 08 13:38:57 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_with_ps', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'min_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:38:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:38:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '183e19e6-70f9-4cad-a643-7f30944269b1'}
Oct 08 13:38:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 183e19e6-70f9-4cad-a643-7f30944269b1 взамен удаленной 97937c58-079b-4fd4-8867-8bf5e91f7ace
Oct 08 13:39:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:39:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr14
Oct 08 13:39:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3340, 'uuid': '183e19e6-70f9-4cad-a643-7f30944269b1', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:39:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 183e19e6-70f9-4cad-a643-7f30944269b1 for delete
Oct 08 13:39:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:39:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 183e19e6-70f9-4cad-a643-7f30944269b1
Oct 08 13:39:14 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_with_ps', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'min_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:39:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:39:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'd476d77c-e3c8-4c90-995c-baa66b340286'}
Oct 08 13:39:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица d476d77c-e3c8-4c90-995c-baa66b340286 взамен удаленной 183e19e6-70f9-4cad-a643-7f30944269b1
Oct 08 13:39:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:39:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr2
Oct 08 13:39:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3330, 'uuid': '27bc15f4-6412-456d-81cd-c80bf673971a', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:39:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 27bc15f4-6412-456d-81cd-c80bf673971a for delete
Oct 08 13:39:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:39:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 27bc15f4-6412-456d-81cd-c80bf673971a
Oct 08 13:39:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'total_color', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'qq', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'color', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'green', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'yellow', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'red', 'is_primary_key': False, 'data_type': 'bigint', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'absolute', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'procent', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 13:39:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:39:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '0656bc25-8763-4029-be7c-43d315d18daf'}
Oct 08 13:39:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 0656bc25-8763-4029-be7c-43d315d18daf взамен удаленной 27bc15f4-6412-456d-81cd-c80bf673971a
Oct 08 13:39:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:39:37 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12114_fast
Oct 08 13:39:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12114_fast', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3306, 'uuid': '985885b6-2fc4-47e7-aaaa-b99d6fbebbe1', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:39:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 985885b6-2fc4-47e7-aaaa-b99d6fbebbe1 for delete
Oct 08 13:39:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:39:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 985885b6-2fc4-47e7-aaaa-b99d6fbebbe1
Oct 08 13:39:38 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12114_fast', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_fact_plan_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'dev_plan_fact_past_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'percent_forecast_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_dev_avg', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_plan_fact_past', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_fact_plan_upper', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'descr_dynamic', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 13:39:39 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:39:39 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '70a036f6-ec20-4b64-ba6c-11cf4fe0a972'}
Oct 08 13:39:39 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 70a036f6-ec20-4b64-ba6c-11cf4fe0a972 взамен удаленной 985885b6-2fc4-47e7-aaaa-b99d6fbebbe1
Oct 08 13:39:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:41:20 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc1_scr2
Oct 08 13:41:20 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr2', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3328, 'uuid': 'd6040657-6100-4c19-91f7-179e9857b90d', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:41:20 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid d6040657-6100-4c19-91f7-179e9857b90d for delete
Oct 08 13:41:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:41:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: d6040657-6100-4c19-91f7-179e9857b90d
Oct 08 13:41:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr2', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'yyyy', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'project', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}]}
Oct 08 13:41:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:41:21 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '175e5b62-23d2-430c-9848-d70c80d08ddb'}
Oct 08 13:41:22 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 175e5b62-23d2-430c-9848-d70c80d08ddb взамен удаленной d6040657-6100-4c19-91f7-179e9857b90d
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 13:41:25 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:06 later at 2024-10-08 10:41:31.229539+00:00
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:41:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:10:30 later at 2024-10-08 10:51:56.597516+00:00
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 13:41:32 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:00:21 later at 2024-10-08 10:41:53.462585+00:00
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 13:41:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:01:26 later at 2024-10-08 10:43:24.343473+00:00
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 13:43:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:04:21 later at 2024-10-08 10:47:50.473927+00:00
Oct 08 13:45:15 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:45:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr14
Oct 08 13:45:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3341, 'uuid': 'd476d77c-e3c8-4c90-995c-baa66b340286', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:45:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid d476d77c-e3c8-4c90-995c-baa66b340286 for delete
Oct 08 13:45:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:45:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: d476d77c-e3c8-4c90-995c-baa66b340286
Oct 08 13:45:28 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_with_ps', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'min_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:45:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:45:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'c4fe1697-3faf-4ebe-aeaf-f9d8edca9ef6'}
Oct 08 13:45:29 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица c4fe1697-3faf-4ebe-aeaf-f9d8edca9ef6 взамен удаленной d476d77c-e3c8-4c90-995c-baa66b340286
Oct 08 13:47:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:52:44 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12
Oct 08 13:52:44 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3334, 'uuid': 'ed0095dd-9c92-49a5-9ac5-963e9bf94817', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:52:44 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid ed0095dd-9c92-49a5-9ac5-963e9bf94817 for delete
Oct 08 13:52:44 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:52:44 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: ed0095dd-9c92-49a5-9ac5-963e9bf94817
Oct 08 13:52:44 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:52:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:52:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '05a34c71-5a65-437c-a7a1-e53347f2fcc9'}
Oct 08 13:52:45 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 05a34c71-5a65-437c-a7a1-e53347f2fcc9 взамен удаленной ed0095dd-9c92-49a5-9ac5-963e9bf94817
Oct 08 13:52:46 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 13:58:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12
Oct 08 13:58:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3346, 'uuid': '05a34c71-5a65-437c-a7a1-e53347f2fcc9', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.308957', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 13:58:06 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 05a34c71-5a65-437c-a7a1-e53347f2fcc9 for delete
Oct 08 13:58:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 13:58:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 05a34c71-5a65-437c-a7a1-e53347f2fcc9
Oct 08 13:58:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 13:58:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 13:58:07 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': 'e6f5cc27-cb93-4f82-afbb-7fb7bba974cd'}
Oct 08 13:58:08 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица e6f5cc27-cb93-4f82-afbb-7fb7bba974cd взамен удаленной 05a34c71-5a65-437c-a7a1-e53347f2fcc9
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 13:58:09 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:10:30 later at 2024-10-08 11:08:39.057488+00:00
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 13:58:10 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:21:41 later at 2024-10-08 11:19:51.474676+00:00
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 547, in _write
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     f = float(token)
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: float() argument must be a string or a number, not 'UUID'
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 498, in convert_data_to_xlsx
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     worksheet.write(row_num, col, cell_data, cell_format)
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 107, in cell_wrapper
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return method(self, *args, **kwargs)
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 478, in write
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._write(row, col, *args)
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/xlsxwriter/worksheet.py", line 552, in _write
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise TypeError("Unsupported type %s in write()" % type(token))
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: Unsupported type <class 'uuid.UUID'> in write()
Oct 08 13:58:16 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 2:46:45 later at 2024-10-08 13:45:01.938555+00:00
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 14:08:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:21:41 later at 2024-10-08 11:30:21.390324+00:00
Oct 08 14:15:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 14:15:03 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE transform_s1_result
Oct 08 14:15:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'transform_s1_result', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3294, 'uuid': '104d9d43-e935-42d9-87de-3f195d736faa', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 14:15:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 104d9d43-e935-42d9-87de-3f195d736faa for delete
Oct 08 14:15:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 14:15:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 104d9d43-e935-42d9-87de-3f195d736faa
Oct 08 14:15:04 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'transform_s1_result', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'value', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'date', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}]}
Oct 08 14:15:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 14:15:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '0c8976f7-f986-4c09-aef0-dee4e41c5a50'}
Oct 08 14:15:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 0c8976f7-f986-4c09-aef0-dee4e41c5a50 взамен удаленной 104d9d43-e935-42d9-87de-3f195d736faa
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 14:19:53 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:40:06 later at 2024-10-08 11:59:59.243539+00:00
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 14:30:26 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 0:40:06 later at 2024-10-08 12:10:32.552654+00:00
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 15:00:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:08:21 later at 2024-10-08 13:08:26.189837+00:00
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 15:10:33 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:08:21 later at 2024-10-08 13:18:54.532056+00:00
Oct 08 15:54:40 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 15:59:58 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12
Oct 08 15:59:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3347, 'uuid': 'e6f5cc27-cb93-4f82-afbb-7fb7bba974cd', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 15:59:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid e6f5cc27-cb93-4f82-afbb-7fb7bba974cd for delete
Oct 08 15:59:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 15:59:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: e6f5cc27-cb93-4f82-afbb-7fb7bba974cd
Oct 08 15:59:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 15:59:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 15:59:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '3283fa69-a4e8-46e4-a34d-a7aa28cbbd6f'}
Oct 08 16:00:00 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 3283fa69-a4e8-46e4-a34d-a7aa28cbbd6f взамен удаленной e6f5cc27-cb93-4f82-afbb-7fb7bba974cd
Oct 08 16:05:27 sppr-app1.vniigaz.gazprom.ru sh[2579949]: DATA collected for source None
Oct 08 16:10:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: trying to delete table from SE tr_sc4_scr12
Oct 08 16:10:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3349, 'uuid': '3283fa69-a4e8-46e4-a34d-a7aa28cbbd6f', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 16:10:48 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Obtained table_uuid 3283fa69-a4e8-46e4-a34d-a7aa28cbbd6f for delete
Oct 08 16:10:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 16:10:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Удалена таблица с UUID: 3283fa69-a4e8-46e4-a34d-a7aa28cbbd6f
Oct 08 16:10:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 16:10:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SE POST table_and_fields/ responses:
Oct 08 16:10:49 sppr-app1.vniigaz.gazprom.ru sh[2579949]:  {'uuid': '872cd1cd-f7fa-44e7-a011-3d749920611f'}
Oct 08 16:10:50 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Создана таблица 872cd1cd-f7fa-44e7-a011-3d749920611f взамен удаленной 3283fa69-a4e8-46e4-a34d-a7aa28cbbd6f
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: --- Logging error ---
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = self.format(record)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return fmt.format(record)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     record.message = record.getMessage()
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     msg = msg % self.args
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: TypeError: not all arguments converted during string formatting
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Call stack:
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     main()
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     execute_from_command_line(sys.argv)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     utility.execute()
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.execute(*args, **cmd_options)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     output = self.handle(*args, **options)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run(*args, **options)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     if not self._tasks.run_next_task(queue):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._runner.run_next_task(self, queue)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.run_task(tasks, task)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tasks.run_task(task)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Message: 'Exception!'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist\nLINE 9: from header_material_bal hb\n             ^\n'),)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: psycopg2.errors.UndefinedTable: relation "header_material_bal" does not exist
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: The above exception was the direct cause of the following exception:
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = connection.execute(text(stmt))
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return meth(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return connection._execute_clauseelement(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     ret = self._execute_context(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return self._exec_single_context(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self._handle_dbapi_exception(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     self.dialect.do_execute(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     cursor.execute(statement, parameters)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     result = self.send_statement(prepared_sql)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "header_material_bal" does not exist
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: LINE 9: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]:              ^
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: [SQL: select * from (with geo as(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'ecb69d07-04bd-4b06-90e8-f9e777cfd7ef'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.year,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'c7f33b7d-6e3f-4820-904f-7ea880df8aee'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '54b92c62-3eb0-4d90-90f1-17c63aed30da'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extractable as(
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value/1000) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³'as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '0ce68290-5c20-429b-93b2-4527373ecf5e'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as oil,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = '611203d5-1d72-43da-beec-0c48237f0afe'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from hb.start_date) as yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: sum(pb.value) as ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p.short_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from header_material_bal hb
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pden_material_bal pb on pb.header_uuid = hb.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join horizon h on h.uuid = pb.horizon_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = h.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p on p.field_uuid = f.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: where pb.analytics_uuid = 'd4f0e883-e618-4f6a-9d4e-eb07a693bf88'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f.name,hb.start_date,p.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact as(with fact as (select max(pvsf.start_date) as max_date,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: extract(year from pvsf.start_date) as year_fact,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f."name" field_name,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name pool_name,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (CASE
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газовое' or dd.field_type = 'нефтегазовое' or dd.field_type = 'газонефтяное' then dd.gas_dry/1000
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: when dd.field_type = 'газоконденсатное' or dd.field_type = 'нефтегазоконденсатное' then dd.gas_sep/1000
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: end) AS value_fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '06dbb967-b79e-453b-8c9f-e0b8553235c8' THEN pvsf2.value END) AS gas_sep,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = 'e3eee3b4-9509-4cf6-b2f4-b74b71e280e2' THEN pvsf2.value END) AS gas_dry
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.gk
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '484eb7c1-98ab-4b53-98ff-e0ac1827920f' then pvsf2.value END) as gk
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2.name = f.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_gk,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: dd.oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM (
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SELECT
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name as field_type,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: SUM(CASE WHEN pvsf2.analytics_uuid = '77313edd-8944-400b-bd9c-fe6298ab96f1' then pvsf2.value END) as oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: FROM header_fact hf2
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pden_vol_summary_fact pvsf2 ON pvsf2.header_uuid = hf2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN field f2 ON hf2.field_uuid = f2.uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: INNER JOIN pool p on p.field_uuid = f2.uuid and p.uuid = pvsf2.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join r_field_type rft on rft.uuid = p.type_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: WHERE pvsf2.analytic_type_uuid = '898072b6-e81f-4fe3-9072-6b943116e8bf'
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f2."name" = f."name"
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and p.short_name = p2.short_name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and pvsf2.start_date = max(pvsf.start_date)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: GROUP BY
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: rft.name
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) dd
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) fact_oil
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from pden_vol_summary_fact pvsf
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join pool p2 on p2.uuid = pvsf.pool_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: inner join field f on f.uuid = p2.field_uuid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by f."name" ,extract(year from pvsf.start_date),
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: p2.short_name)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gas as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газ' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'млрд м³' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_gk as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Газовый конденсат' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: union all
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select field_name as field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: pool_name as pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: fact_oil as gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'Нефть' as fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: 'тыс. Т' as units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: )
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: select distinct
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(geo.geo))geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex))ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas) over(partition by f.field,f.fluid)/100) as fact,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(ex.ex) over(partition by f.field,f.fluid)/sum(geo.geo) over(partition by f.field,f.fluid),2) as rent_kig,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: round(sum(f.gas/100) over(partition by f.field,f.fluid)/sum(ex.ex) over(partition by f.field,f.fluid),2) as accumulated_kig
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: from fact f
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join geo geo on /*ex.yyyy = geo.yyyy
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: andgeo.field=  ex.field
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and*/ geo.fluid = f.fluid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.pool = f.pool
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and geo.units = f.units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: left join extractable ex on f.pool = ex.pool
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.fluid = ex.fluid
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: and f.units = ex.units
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: group by
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.field,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.fluid,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.pool,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.ex,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: geo.geo,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.gas,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: f.units,
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ex.yyyy
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: ) x ]
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 16:10:51 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:49:26 later at 2024-10-08 15:00:17.692434+00:00
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Not Found
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise CacheMiss()
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: apps.bi.exceptions.CacheMiss
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: During handling of the above exception, another exception occurred:
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Traceback (most recent call last):
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     func(*args, **kwargs)
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     data = switch_connector(credentials)._get_db_data(
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     tablename = self.obtain_tablename(
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]:     raise BadRequest(error)
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: packages.exceptions.BadRequest: Not Found
Oct 08 16:18:59 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Rescheduling task bi.tasks.convert_data_to_xlsx for 1:49:26 later at 2024-10-08 15:08:25.496405+00:00
Oct 08 16:22:05 sppr-app1.vniigaz.gazprom.ru sh[2579949]: Failed to retrieve tasks. Database unreachable.
Oct 08 16:25:26 sppr-app1.vniigaz.gazprom.ru systemd[1]: Stopping sppr bi-process-tasks service...
Oct 08 16:25:26 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Succeeded.
Oct 08 16:25:26 sppr-app1.vniigaz.gazprom.ru systemd[1]: Stopped sppr bi-process-tasks service.
Oct 08 16:25:26 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Consumed 2min 19.417s CPU time.
Oct 08 16:25:26 sppr-app1.vniigaz.gazprom.ru systemd[1]: Started sppr bi-process-tasks service.
Oct 08 16:26:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: Stopping sppr bi-process-tasks service...
Oct 08 16:26:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Succeeded.
Oct 08 16:26:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: Stopped sppr bi-process-tasks service.
Oct 08 16:26:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Consumed 3.709s CPU time.
Oct 08 16:26:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: Started sppr bi-process-tasks service.
Oct 08 16:36:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: Stopping sppr bi-process-tasks service...
Oct 08 16:36:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Succeeded.
Oct 08 16:36:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: Stopped sppr bi-process-tasks service.
Oct 08 16:36:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: sppr-bi-process-task.service: Consumed 4.358s CPU time.
Oct 08 16:36:35 sppr-app1.vniigaz.gazprom.ru systemd[1]: Started sppr bi-process-tasks service.
Oct 08 17:00:48 sppr-app1.vniigaz.gazprom.ru sh[3864057]: DATA collected for source None
Oct 08 17:06:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: trying to delete table from SE tr_sc4_scr12
Oct 08 17:06:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3333, 'uuid': 'd2bc0d76-f381-4ce7-98e4-d4e870219415', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-07T16:10:08.945193', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 17:06:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Obtained table_uuid d2bc0d76-f381-4ce7-98e4-d4e870219415 for delete
Oct 08 17:06:04 sppr-app1.vniigaz.gazprom.ru sh[3864057]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 17:06:04 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Удалена таблица с UUID: d2bc0d76-f381-4ce7-98e4-d4e870219415
Oct 08 17:06:04 sppr-app1.vniigaz.gazprom.ru sh[3864057]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 17:06:04 sppr-app1.vniigaz.gazprom.ru sh[3864057]: SE POST table_and_fields/ responses:
Oct 08 17:06:04 sppr-app1.vniigaz.gazprom.ru sh[3864057]:  {'uuid': '19113886-f43f-4cbb-8531-23ca607f35d3'}
Oct 08 17:06:05 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Создана таблица 19113886-f43f-4cbb-8531-23ca607f35d3 взамен удаленной d2bc0d76-f381-4ce7-98e4-d4e870219415
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Not Found
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Rescheduling bi.tasks.convert_data_to_xlsx
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     raise CacheMiss()
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: apps.bi.exceptions.CacheMiss
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: During handling of the above exception, another exception occurred:
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     func(*args, **kwargs)
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/tasks.py", line 429, in convert_data_to_xlsx
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     data = switch_connector(credentials)._get_db_data(
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 351, in _get_db_data
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     tablename = self.obtain_tablename(
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/connector.py", line 125, in obtain_tablename
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return SEIntegration.obtain_tablename(token, table_id)
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/external_requests.py", line 270, in obtain_tablename
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     raise BadRequest(error)
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: packages.exceptions.BadRequest: Not Found
Oct 08 17:06:06 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Rescheduling task bi.tasks.convert_data_to_xlsx for 2:46:45 later at 2024-10-08 16:52:51.051099+00:00
Oct 08 17:08:02 sppr-app1.vniigaz.gazprom.ru sh[3864057]: DATA collected for source None
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: --- Logging error ---
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     raise CacheMiss()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: apps.bi.exceptions.CacheMiss
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: During handling of the above exception, another exception occurred:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.dialect.do_execute(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     cursor.execute(statement, parameters)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:                                              ^
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: The above exception was the direct cause of the following exception:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     result = connection.execute(text(stmt))
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return meth(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return connection._execute_clauseelement(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     ret = self._execute_context(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return self._exec_single_context(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self._handle_dbapi_exception(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.dialect.do_execute(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     cursor.execute(statement, parameters)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:                                              ^
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: During handling of the above exception, another exception occurred:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     msg = self.format(record)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return fmt.format(record)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     record.message = record.getMessage()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     msg = msg % self.args
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: TypeError: not all arguments converted during string formatting
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Call stack:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     main()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     execute_from_command_line(sys.argv)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     utility.execute()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.execute(*args, **cmd_options)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     output = self.handle(*args, **options)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.run(*args, **options)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     if not self._tasks.run_next_task(queue):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return self._runner.run_next_task(self, queue)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.run_task(tasks, task)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     tasks.run_task(task)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     func(*args, **kwargs)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     task = TransformationTask(conditions)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     result = self.send_statement(prepared_sql)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 108, in send_statement
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     logger.exception("Exception!", err.with_traceback(err.__traceback__))
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Message: 'Exception!'
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Arguments: (ProgrammingError('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n'),)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: --- Logging error ---
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 244, in _get_db_data
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     raise CacheMiss()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: apps.bi.exceptions.CacheMiss
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: During handling of the above exception, another exception occurred:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.dialect.do_execute(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     cursor.execute(statement, parameters)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: psycopg2.errors.UndefinedTable: relation "table_transform_ksts" does not exist
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:                                              ^
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: The above exception was the direct cause of the following exception:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 102, in send_statement
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     result = connection.execute(text(stmt))
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1418, in execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return meth(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/sql/elements.py", line 515, in _execute_on_connection
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return connection._execute_clauseelement(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1640, in _execute_clauseelement
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     ret = self._execute_context(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1846, in _execute_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return self._exec_single_context(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1986, in _exec_single_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self._handle_dbapi_exception(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 2355, in _handle_dbapi_exception
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     raise sqlalchemy_exception.with_traceback(exc_info[2]) from e
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/base.py", line 1967, in _exec_single_context
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.dialect.do_execute(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/sqlalchemy/engine/default.py", line 941, in do_execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     cursor.execute(statement, parameters)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: sqlalchemy.exc.ProgrammingError: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:                                              ^
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: During handling of the above exception, another exception occurred:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/tasks.py", line 147, in __init__
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.conditions["data"] = self.input_db_connector._get_db_data(
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 434, in _get_db_data
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     result = self.send_statement(prepared_sql)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/databases.py", line 109, in send_statement
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     raise BadRequest(f"{err.with_traceback(err.__traceback__)}")
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: packages.exceptions.BadRequest: (psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: LINE 1: select * from (select year_fact from table_transform_ksts) x...
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:                                              ^
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: [SQL: select * from (select year_fact from table_transform_ksts) x ]
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: (Background on this error at: https://sqlalche.me/e/20/f405)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: During handling of the above exception, another exception occurred:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Traceback (most recent call last):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 1081, in emit
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     msg = self.format(record)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 925, in format
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return fmt.format(record)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 664, in format
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     record.message = record.getMessage()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/usr/lib64/python3.8/logging/__init__.py", line 369, in getMessage
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     msg = msg % self.args
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: TypeError: not all arguments converted during string formatting
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Call stack:
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/manage.py", line 22, in <module>
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     main()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/manage.py", line 18, in main
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     execute_from_command_line(sys.argv)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 442, in execute_from_command_line
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     utility.execute()
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/__init__.py", line 436, in execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.fetch_command(subcommand).run_from_argv(self.argv)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 412, in run_from_argv
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.execute(*args, **cmd_options)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/django/core/management/base.py", line 458, in execute
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     output = self.handle(*args, **options)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 123, in handle
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.run(*args, **options)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/management/commands/process_tasks.py", line 105, in run
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     if not self._tasks.run_next_task(queue):
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 139, in run_next_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     return self._runner.run_next_task(self, queue)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 265, in run_next_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self.run_task(tasks, task)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 260, in run_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     tasks.run_task(task)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 136, in run_task
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     self._bg_runner(proxy_task, task, *args, **kwargs)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/.venv/lib64/python3.8/site-packages/background_task/tasks.py", line 45, in bg_runner
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     func(*args, **kwargs)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/tasks.py", line 388, in make_transformation
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     task = TransformationTask(conditions)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:   File "/opt/backend/bi/apps/bi/tasks.py", line 151, in __init__
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]:     logger.exception("Exception!", e.with_traceback(e.__traceback__))
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Message: 'Exception!'
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Arguments: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'),)
Oct 08 17:08:03 sppr-app1.vniigaz.gazprom.ru sh[3864057]: (BadRequest('(psycopg2.errors.UndefinedTable) relation "table_transform_ksts" does not exist\nLINE 1: select * from (select year_fact from table_transform_ksts) x...\n                                             ^\n\n[SQL: select * from (select year_fact from table_transform_ksts) x ]\n(Background on this error at: https://sqlalche.me/e/20/f405)'), 'Ошибка получения данных из базы')
Oct 08 17:23:58 sppr-app1.vniigaz.gazprom.ru sh[3864057]: DATA collected for source None
Oct 08 17:29:29 sppr-app1.vniigaz.gazprom.ru sh[3864057]: trying to delete table from SE tr_sc4_scr12
Oct 08 17:29:29 sppr-app1.vniigaz.gazprom.ru sh[3864057]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3338, 'uuid': '19113886-f43f-4cbb-8531-23ca607f35d3', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '490f26a0-a558-4dce-ac3f-30dc3f1c8378', 'creation_date': '2024-10-07T18:02:36.437863', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 17:29:29 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Obtained table_uuid 19113886-f43f-4cbb-8531-23ca607f35d3 for delete
Oct 08 17:29:30 sppr-app1.vniigaz.gazprom.ru sh[3864057]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 17:29:30 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Удалена таблица с UUID: 19113886-f43f-4cbb-8531-23ca607f35d3
Oct 08 17:29:30 sppr-app1.vniigaz.gazprom.ru sh[3864057]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 17:29:30 sppr-app1.vniigaz.gazprom.ru sh[3864057]: SE POST table_and_fields/ responses:
Oct 08 17:29:30 sppr-app1.vniigaz.gazprom.ru sh[3864057]:  {'uuid': '10ecabb3-ae16-4143-8bb7-469ced772b7a'}
Oct 08 17:29:31 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Создана таблица 10ecabb3-ae16-4143-8bb7-469ced772b7a взамен удаленной 19113886-f43f-4cbb-8531-23ca607f35d3
Oct 08 17:40:05 sppr-app1.vniigaz.gazprom.ru sh[3864057]: DATA collected for source None
Oct 08 17:40:15 sppr-app1.vniigaz.gazprom.ru sh[3864057]: trying to delete table from SE tr_sc4_scr12_fast
Oct 08 17:40:15 sppr-app1.vniigaz.gazprom.ru sh[3864057]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr12_fast', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3321, 'uuid': 'ec6ccdac-28a8-48c6-a438-9258ffcf1a62', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-07T16:10:08.931885', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 17:40:15 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Obtained table_uuid ec6ccdac-28a8-48c6-a438-9258ffcf1a62 for delete
Oct 08 17:40:15 sppr-app1.vniigaz.gazprom.ru sh[3864057]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 17:40:15 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Удалена таблица с UUID: ec6ccdac-28a8-48c6-a438-9258ffcf1a62
Oct 08 17:40:15 sppr-app1.vniigaz.gazprom.ru sh[3864057]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr12_fast', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact_prev', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'name_group', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'type_num', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_1', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_2', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_3', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_4', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_5', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas_6', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 17:40:16 sppr-app1.vniigaz.gazprom.ru sh[3864057]: SE POST table_and_fields/ responses:
Oct 08 17:40:16 sppr-app1.vniigaz.gazprom.ru sh[3864057]:  {'uuid': '2f4c88a1-4007-42b4-93ea-9c9f7d7aba75'}
Oct 08 17:40:16 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Создана таблица 2f4c88a1-4007-42b4-93ea-9c9f7d7aba75 взамен удаленной ec6ccdac-28a8-48c6-a438-9258ffcf1a62
Oct 08 17:40:18 sppr-app1.vniigaz.gazprom.ru sh[3864057]: DATA collected for source None
Oct 08 17:43:41 sppr-app1.vniigaz.gazprom.ru sh[3864057]: trying to delete table from SE tr_sc1_scr5
Oct 08 17:43:41 sppr-app1.vniigaz.gazprom.ru sh[3864057]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc1_scr5', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3330, 'uuid': '3242b471-5e20-45cd-88c4-7c65f80945ae', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-07T16:10:08.931885', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 17:43:41 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Obtained table_uuid 3242b471-5e20-45cd-88c4-7c65f80945ae for delete
Oct 08 17:43:42 sppr-app1.vniigaz.gazprom.ru sh[3864057]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 17:43:42 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Удалена таблица с UUID: 3242b471-5e20-45cd-88c4-7c65f80945ae
Oct 08 17:43:42 sppr-app1.vniigaz.gazprom.ru sh[3864057]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc1_scr5', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'fluid', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'units', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month_text', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'field_name', 'is_primary_key': False, 'data_type': 'varchar', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'well_name', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'avg_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'p_mpa', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 17:43:43 sppr-app1.vniigaz.gazprom.ru sh[3864057]: SE POST table_and_fields/ responses:
Oct 08 17:43:43 sppr-app1.vniigaz.gazprom.ru sh[3864057]:  {'uuid': '2193c0b4-9c11-4099-84dd-919484794536'}
Oct 08 17:43:43 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Создана таблица 2193c0b4-9c11-4099-84dd-919484794536 взамен удаленной 3242b471-5e20-45cd-88c4-7c65f80945ae
Oct 08 17:44:14 sppr-app1.vniigaz.gazprom.ru sh[3864057]: DATA collected for source None
Oct 08 17:44:27 sppr-app1.vniigaz.gazprom.ru sh[3864057]: trying to delete table from SE tr_sc4_scr14
Oct 08 17:44:27 sppr-app1.vniigaz.gazprom.ru sh[3864057]: get_table_uuid answers {'status_code': 200, 'data': [{'description': 'Трансформированная таблица', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'classification_uid': '67722748-17ca-454f-aa02-bae5d9fee3d9', 'classification_uid_field_name': 'Медвежье НГКМ', 'id': 3325, 'uuid': '4261d827-cb10-4cff-af2b-9d3d35a55029', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'need_to_create': True, 'is_managed_by_classify': False, 'engine': None, 'author': '36fc4427-cbd3-4664-a21e-28d0fa4f2349', 'creation_date': '2024-10-07T16:10:08.931885', 'status': 'created', 'schema_name': 'public'}]}
Oct 08 17:44:27 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Obtained table_uuid 4261d827-cb10-4cff-af2b-9d3d35a55029 for delete
Oct 08 17:44:27 sppr-app1.vniigaz.gazprom.ru sh[3864057]: wipe table answer {'status_code': 204, 'data': <Response [204]>}
Oct 08 17:44:27 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Удалена таблица с UUID: 4261d827-cb10-4cff-af2b-9d3d35a55029
Oct 08 17:44:27 sppr-app1.vniigaz.gazprom.ru sh[3864057]: {'description': 'Трансформированная таблица', 'db_uuid': '87056d79-9d78-412a-91bf-16861a400f7f', 'name': 'tr_sc4_scr14', 'is_datamart': True, 'need_to_create': True, 'fields': [{'description': 'Трансформированная колонка', 'name': 'q_filter', 'is_primary_key': False, 'data_type': 'integer', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'mm_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'year_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'q_plan', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'month', 'is_primary_key': False, 'data_type': 'text', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_with_ps', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'min_day_gas', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}, {'description': 'Трансформированная колонка', 'name': 'max_day_gas_fact', 'is_primary_key': False, 'data_type': 'numeric', 'null': True}]}
Oct 08 17:44:28 sppr-app1.vniigaz.gazprom.ru sh[3864057]: SE POST table_and_fields/ responses:
Oct 08 17:44:28 sppr-app1.vniigaz.gazprom.ru sh[3864057]:  {'uuid': 'dea16283-47d5-4112-bd59-66fb214e0c60'}
Oct 08 17:44:28 sppr-app1.vniigaz.gazprom.ru sh[3864057]: Создана таблица dea16283-47d5-4112-bd59-66fb214e0c60 взамен удаленной 4261d827-cb10-4cff-af2b-9d3d35a55029
Oct 08 17:44:29 sppr-app1.vniigaz.gazprom.ru sh[3864057]: DATA collected for source None
